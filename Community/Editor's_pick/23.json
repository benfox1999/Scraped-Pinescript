{"created":"2024-06-03T00:12:27.392187Z","extra":{"kind":"study","sourceInputsCount":0},"lastVersionMaj":"13.0","scriptAccess":"open_no_auth","scriptName":"Live Economic Calendar by toodegrees","source":"// This Pine Scriptâ„¢ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/\r\n// Â© toodegrees\r\nimport toodegrees/forex_factory_utility/14 as ffUtil\r\nimport toodegrees/forex_factory_decoding/16 as ffDec\r\n\r\n \r\n//@version=5\r\nindicator(\"Live Economic Calendar by toodegrees\"\r\n         , shorttitle=\"NewsÂ° [toodegrees]\"\r\n         , overlay=true\r\n         , max_lines_count=500\r\n         , max_labels_count=500)\r\n\r\n\r\n//#region[Timeframe Limitations]\r\nif timeframe.in_seconds(timeframe.period)>86400\r\n    runtime.error(\"Go to the Daily Timeframe or lower!\")\r\nelse if timeframe.in_seconds(timeframe.period)<30\r\n    runtime.error(\"Go to the 30-Second Timeframe or higher!\")\r\n//#endregion\r\n\r\n\r\n//#region[Global, Functions, Methods]\r\nvar mdnCheck = false\r\nif hour(time,\"America/New_York\")==0 and hour(time[1],\"America/New_York\")!=0 and not mdnCheck\r\n    mdnCheck := true\r\nnewDay = mdnCheck ? hour(time,\"America/New_York\")==0 and hour(time[1],\"America/New_York\")!=0 : timeframe.change(\"D\")\r\n\r\nrequestData() =>\r\n    [request.seed(\"seed_toodegrees_toogit\",\"TOODEGREES_FOREX_FACTORY_SLOT_1\",str.tostring(open)+\",\"+str.tostring(high)+\",\"+str.tostring(low)+\",\"+str.tostring(close)+\",\"+str.tostring(volume)),\r\n     request.seed(\"seed_toodegrees_toogit\",\"TOODEGREES_FOREX_FACTORY_SLOT_2\",str.tostring(open)+\",\"+str.tostring(high)+\",\"+str.tostring(low)+\",\"+str.tostring(close)+\",\"+str.tostring(volume)),\r\n     request.seed(\"seed_toodegrees_toogit\",\"TOODEGREES_FOREX_FACTORY_SLOT_3\",str.tostring(open)+\",\"+str.tostring(high)+\",\"+str.tostring(low)+\",\"+str.tostring(close)+\",\"+str.tostring(volume)),\r\n     request.seed(\"seed_toodegrees_toogit\",\"TOODEGREES_FOREX_FACTORY_SLOT_4\",str.tostring(open)+\",\"+str.tostring(high)+\",\"+str.tostring(low)+\",\"+str.tostring(close)+\",\"+str.tostring(volume)),\r\n     request.seed(\"seed_toodegrees_toogit\",\"TOODEGREES_FOREX_FACTORY_SLOT_5\",str.tostring(open)+\",\"+str.tostring(high)+\",\"+str.tostring(low)+\",\"+str.tostring(close)+\",\"+str.tostring(volume)),\r\n     request.seed(\"seed_toodegrees_toogit\",\"TOODEGREES_FOREX_FACTORY_SLOT_6\",str.tostring(open)+\",\"+str.tostring(high)+\",\"+str.tostring(low)+\",\"+str.tostring(close)+\",\"+str.tostring(volume)),\r\n     request.seed(\"seed_toodegrees_toogit\",\"TOODEGREES_FOREX_FACTORY_SLOT_7\",str.tostring(open)+\",\"+str.tostring(high)+\",\"+str.tostring(low)+\",\"+str.tostring(close)+\",\"+str.tostring(volume)),\r\n     request.seed(\"seed_toodegrees_toogit\",\"TOODEGREES_FOREX_FACTORY_SLOT_8\",str.tostring(open)+\",\"+str.tostring(high)+\",\"+str.tostring(low)+\",\"+str.tostring(close)+\",\"+str.tostring(volume)),\r\n     request.seed(\"seed_toodegrees_toogit\",\"TOODEGREES_FOREX_FACTORY_SLOT_9\",str.tostring(open)+\",\"+str.tostring(high)+\",\"+str.tostring(low)+\",\"+str.tostring(close)+\",\"+str.tostring(volume))]\r\n\r\nmethod processData(ffUtil.News[] N, string S1, string S2, string S3, string S4, string S5, string S6, string S7, string S8, string S9) =>\r\n    ffDec.readNews(N,S1), ffDec.readNews(N,S2), ffDec.readNews(N,S3)\r\n    ffDec.readNews(N,S4), ffDec.readNews(N,S5), ffDec.readNews(N,S6)\r\n    ffDec.readNews(N,S7), ffDec.readNews(N,S8), ffDec.readNews(N,S9)\r\n//#endregion\r\n\r\n\r\n//#region[Tooltips]\r\nvar custom_timezoneTT = \"The original Time and Date of the News is based on New York EST. Adjust the Timezone \"\r\n                      + \"by matching this setting to the bottom-right Timezone setting on your Chart.\"\r\nvar expectedImpactTT  = \"ðŸ”´ High Impact\\nðŸŸ  Medium Impact\\nðŸŸ¡ Low Impact\\nâšª Holiday\"\r\nvar autoTT            = \"Automatically chooses the Currencies' News based on the current symbol on Chart.\"\r\nvar onChartTT         = \"'Today'\\nAll historical news will be deleted once a new day starts, only the current day's news \"\r\n                      + \"will be shown on chart.\\n\\n'This Week'\\nAll historical news will be deleted once a new week \"\r\n                      + \"starts, only the current week's news will be shown on chart.\\n\\n'Manual'\\nWill show the current \"\r\n                      + \"week's upcoming news as well as the news in the prior custom number of days (includes weekend days).\"\r\nvar labelYTT          = \"'Auto' will place the label opposite to the candle's direction.\"\r\nvar sizeTTT           = \"Depending on the Size of the News Table you will be able to see a maximum number of Forex Factory \"\r\n                      + \"News events on the chart due to size limitations.\\n\\nThese limits are roughly:\\n'Tiny' Â± 46 Forex \"\r\n                      + \"Factory News Events\\n'Small' Â± 38 Forex Factory News Events\\n'Normal' Â± 28 Forex Factory News Events\"\r\n                      + \"\\n'Large' Â± 20 Forex Factory News Events\\n'Huge' Â± 11 Forex Factory News Events\"\r\nvar tableHeadCTT      = \"Text Color - Backroung Color\"\r\nvar tableRowCTT       = \"Past News Text Color - Future News Text Color - Backroung Color\"\r\n//#endregion\r\n\r\n\r\n//#region[User Input]\r\n// Custom Timezone\r\ncustom_timezone = input.bool(false, title=\"Custom Timezone?\", inline=\"1\")\r\ntimezone_h      =  input.int(1    , title=\"UTC\"             , inline=\"1\", minval=-10, maxval=13)\r\ntimezone_m      =  input.int(0    , title=\":\"               , inline=\"1\", minval=0  , maxval=59, step=15, tooltip=custom_timezoneTT)\r\n\r\n// Expected Impact\r\nvar high_impact = input.bool(true, title=\"ðŸ”´\", group=\"Expected Impact\", inline=\"1\")\r\nvar med_impact  = input.bool(true, title=\"ðŸŸ \", group=\"Expected Impact\", inline=\"1\")\r\nvar low_impact  = input.bool(true, title=\"ðŸŸ¡\", group=\"Expected Impact\", inline=\"1\")\r\nvar holiday     = input.bool(true, title=\"âšª\", group=\"Expected Impact\", inline=\"1\", tooltip=expectedImpactTT)\r\n\r\n// Currencies\r\nvar AUTO = input.bool(true , title=\"Automatic?\", group=\"Currencies\", tooltip=autoTT)\r\nvar AUD  = input.bool(false, title=\"AUD\"       , group=\"Currencies\", inline=\"1\")\r\nvar CAD  = input.bool(false, title=\"CAD\"       , group=\"Currencies\", inline=\"1\")\r\nvar CHF  = input.bool(false, title=\"CHF\"       , group=\"Currencies\", inline=\"1\")\r\nvar CNY  = input.bool(false, title=\"CNY\"       , group=\"Currencies\", inline=\"2\")\r\nvar EUR  = input.bool(false, title=\"EUR\"       , group=\"Currencies\", inline=\"2\")\r\nvar GBP  = input.bool(false, title=\"GBP\"       , group=\"Currencies\", inline=\"2\")\r\nvar JPY  = input.bool(false, title=\"JPYÂ \"      , group=\"Currencies\", inline=\"3\")\r\nvar NZD  = input.bool(false, title=\"NZD\"       , group=\"Currencies\", inline=\"3\")\r\nvar USD  = input.bool(false, title=\"USD\"       , group=\"Currencies\", inline=\"3\")\r\n\r\n// On Chart\r\nvar onChartT   =                  input.string(\"This Week\", title=\"Chart HistoryÂ Â Â Â Â Â Â Â Â \", group=\"News On Chart\", inline=\"1\", options=[\"Today\", \"This Week\", \"Manual\"])\r\nvar onChartLB  =                     input.int(30         , title=\"\"                      , group=\"News On Chart\", inline=\"1\", tooltip=onChartTT)\r\nvar showLabels =                    input.bool(true       , title=\"Show Labels?\"          , group=\"News On Chart\", inline=\"2\")\r\nvar labelS     =      ffUtil.size(input.string(\"Normal\"   , title=\"\"                      , group=\"News On Chart\", inline=\"2\", options=[\"Tiny\" , \"Small\", \"Normal\", \"Large\", \"Huge\"]))\r\nvar labelY     =                  input.string(\"Auto\"     , title=\"\"                      , group=\"News On Chart\", inline=\"2\", options=[\"Above\", \"Below\", \"Auto\"] , tooltip=labelYTT)\r\nvar lblOutLn   =                    input.bool(true       , title=\"Outline?\"              , group=\"News On Chart\", inline=\"2\")\r\nvar showLines  =                    input.bool(true       , title=\"Show Lines?Â Â \"         , group=\"News On Chart\", inline=\"3\")\r\nvar lineTime   =                  input.string(\"Future\"   , title=\"\"                      , group=\"News On Chart\", inline=\"3\", options=[\"Future\", \"Past+Future\"])\r\nvar lineT      = ffUtil.lineTrnsp(input.string(\"Heavy\"    , title=\"\"                      , group=\"News On Chart\", inline=\"3\", options=[\"Light\" , \"Medium\", \"Heavy\"]))\r\nvar lineS      = ffUtil.lineStyle(input.string(\"Solid\"    , title=\"\"                      , group=\"News On Chart\", inline=\"3\", options=[\"Dashed\", \"Dotted\", \"Solid\"]))\r\n\r\n// Table\r\nvar showTable =   input.bool(true       , title=\"Show?\"        , group=\"News Table\", inline=\"1\")\r\nvar tableType = input.string(\"This Week\", title=\"\"             , group=\"News Table\", inline=\"1\", options=[\"Today\", \"This Week\"])\r\nvar todType   = input.string(\"24H\"      , title=\"\"             , group=\"News Table\", inline=\"1\", options=[\"24H\"  , \"AM/PM\"])\r\nvar headTextC =  input.color(#dee1e9  , title=\"Table Header\" , group=\"News Table\", inline=\"2\")\r\nvar headBgC   =  input.color(#283c70  , title=\"\"             , group=\"News Table\", inline=\"2\", tooltip=tableHeadCTT)\r\nvar rowTextCP =  input.color(#787b86  , title=\"Table NewsÂ Â Â \", group=\"News Table\", inline=\"3\")\r\nvar rowTextCF =  input.color(#000000  , title=\"\"             , group=\"News Table\", inline=\"3\")\r\nvar rowBgC    =  input.color(#dee1e9  , title=\"\"             , group=\"News Table\", inline=\"3\", tooltip=tableRowCTT)\r\nvar tableX    = input.string(\"Right\"    , title=\"\"             , group=\"News Table\", inline=\"4\", options=[\"Left\", \"Center\", \"Right\" ])\r\nvar tableY    = input.string(\"Bottom\"   , title=\"\"             , group=\"News Table\", inline=\"4\", options=[\"Top\" , \"Middle\", \"Bottom\"])\r\nvar sizeT     = input.string(\"Small\"    , title=\"\"             , group=\"News Table\", inline=\"4\", options=[\"Tiny\", \"Small\" , \"Normal\", \"Large\", \"Huge\"], tooltip=sizeTTT)\r\n\r\n// Process User Input\r\nvar locT            = ffUtil.boxLoc(tableX,tableY)\r\nvar impact_filter   = ffUtil.impFilter(holiday,low_impact,med_impact,high_impact)\r\nvar currency_filter = ffUtil.curFilter(AUTO,AUD,CAD,CHF,CNY,EUR,GBP,JPY,NZD,USD)\r\nonChartT           := timeframe.period==\"D\" and onChartT==\"Today\"?\"This Week\":onChartT \r\ntableType          := timeframe.period==\"D\"?\"This Week\":tableType \r\n//#endregion\r\n\r\n\r\n//#region[Import, Decode, Save]\r\nvar currWeek = array.new<ffUtil.News>()\r\nvar nextWeek = array.new<ffUtil.News>()\r\nvar currDay  = array.new<ffUtil.News>()\r\n\r\n// Import Forex Factory News for next week\r\n[slot1,slot2,slot3,slot4,slot5,slot6,slot7,slot8,slot9] = requestData()\r\n\r\n// Save Forex Factory News\r\nif timeframe.change(\"W\")\r\n    nextWeek := ffUtil.bubbleSort_News(nextWeek)\r\n    if custom_timezone\r\n        nextWeek := ffUtil.adjustTimezone(nextWeek, timezone_h, timezone_m)\r\n    if todType==\"AM/PM\"\r\n        nextWeek := ffUtil.NewsAMPM_TOD(nextWeek)\r\n    currWeek := nextWeek.copy()\r\n    currWeek := ffUtil.weekNews(currWeek,currency_filter,impact_filter)\r\n    nextWeek.clear()\r\nif newDay\r\n    currDay.clear()\r\n    currDay := ffUtil.todayNews(currWeek,currDay,mdnCheck)\r\n\r\n// Decode Forex Factory News\r\nnextWeek.processData(slot1,slot2,slot3,slot4,slot5,slot6,slot7,slot8,slot9)\r\n//#endregion\r\n\r\n\r\n//#region[Table & Drawings]\r\n// Forex Factory News Table\r\nvar  _table = ffUtil.newTable(locT)\r\nif currWeek.size()>0\r\n    if showTable\r\n        if tableType==\"Today\"\r\n            if newDay\r\n                _table := ffUtil.FF_Table(currDay,locT,sizeT,headTextC,headBgC,rowTextCF,rowBgC)\r\n            ffUtil.timeline(currDay,_table,rowTextCP, timezone_h, timezone_m, true)\r\n        else\r\n            if timeframe.change(\"W\")\r\n                _table := ffUtil.FF_Table(currWeek,locT,sizeT,headTextC,headBgC,rowTextCF,rowBgC)\r\n            ffUtil.timeline(currWeek,_table,rowTextCP, timezone_h, timezone_m)\r\n    else\r\n        _table.delete()\r\nelse\r\n    _table.delete()\r\n\r\n// Forex Factory News Drawings\r\nif showLines\r\n    if onChartT!=\"Today\" and timeframe.change(\"W\")\r\n        ffUtil.FF_OnChartLine(currWeek,lineT,lineS)\r\n    else if onChartT==\"Today\" and newDay\r\n        ffUtil.FF_OnChartLine(currDay,lineT,lineS)\r\nif showLabels\r\n    ffUtil.FF_OnChartLabel(currWeek,labelY,labelS,lblOutLn)\r\n\r\nffUtil.historical(onChartLB,onChartT==\"Today\",onChartT==\"This Week\",lineTime)\r\n//#endregion\r\n\r\n\r\n//#region[Daily Chart Buffer]\r\nif timeframe.period==\"D\" and timeframe.change(\"W\") \r\n    nextWeek.processData(slot1,slot2,slot3,slot4,slot5,slot6,slot7,slot8,slot9)\r\n//#endregion//#endregion","updated":"2024-06-03T00:12:27.392187Z","version":"13.0"}