{"created":"2023-10-23T15:55:04.212399Z","extra":{"kind":"study","sourceInputsCount":4},"lastVersionMaj":"17.0","scriptAccess":"open_no_auth","scriptName":"VuManChu B Divergences","source":"//@version=4\r\n\r\n//  Thanks to dynausmaux for the code..\r\n//  Thanks to falconCoin for https://www.tradingview.com/script/KVfgBvDd-Market-Cipher-B-Free-version-with-Buy-and-sell/ inspired me to start this.\r\n//  Thanks to LazyBear for WaveTrend Oscillator https://www.tradingview.com/script/2KE8wTuF-Indicator-WaveTrend-Oscillator-WT/\r\n//  Thanks to RicardoSantos for https://www.tradingview.com/script/3oeDh0Yq-RS-Price-Divergence-Detector-V2/\r\n//  Thanks to LucemAnb for Plain Stochastic Divergence https://www.tradingview.com/script/FCUgF8ag-Plain-Stochastic-Divergence/\r\n//  Thanks to andreholanda73 for MFI+RSI Area https://www.tradingview.com/script/UlGZzUAr/\r\n//  I especially thanks to TradingView for its platform that facilitates development and learning.\r\n//\r\n//  CIRCLES & TRIANGLES:\r\n//    - LITTLE CIRCLE: They appear at all WaveTrend wave crossings.\r\n//    - GREEN CIRCLE: The wavetrend waves are at the oversold level and have crossed up (bullish).\r\n//    - RED CIRCLE: The wavetrend waves are at the overbought level and have crossed down (bearish).\r\n//    - GOLD/ORANGE CIRCLE: When RSI is below 20, WaveTrend waves are below or equal to -80 and have crossed up after good bullish divergence (DONT BUY WHEN GOLD CIRCLE APPEAR).\r\n//    - None of these circles are certain signs to trade. It is only information that can help you. \r\n//    - PURPLE TRIANGLE: Appear when a bullish or bearish divergence is formed and WaveTrend waves crosses at overbought and oversold points.\r\n//\r\n//  NOTES:\r\n//    - I am not an expert trader or know how to program pine script as such, in fact it is my first indicator only to study and all the code is copied and modified from other codes that are published in TradingView.\r\n//    - I am very grateful to the entire TV community that publishes codes so that other newbies like me can learn and present their results. This is an attempt to imitate Market Cipher B. \r\n//    - Settings by default are for 4h timeframe, divergences are more stronger and accurate. Haven't tested in all timeframes, only 2h and 4h.\r\n//    - If you get an interesting result in other timeframes I would be very grateful if you would comment your configuration to implement it or at least check it.\r\n//\r\n//  CONTRIBUTIONS:\r\n//    - Tip/Idea: Add higher timeframe analysis for bearish/bullish patterns at the current timeframe.\r\n//    + Bearish/Bullish FLAG:\r\n//      - MFI+RSI Area are RED (Below 0).\r\n//      - Wavetrend waves are above 0 and crosses down.\r\n//      - VWAP Area are below 0 on higher timeframe.\r\n//      - This pattern reversed becomes bullish.\r\n//    - Tip/Idea: Check the last heikinashi candle from 2 higher timeframe\r\n//    + Bearish/Bullish DIAMOND:\r\n//      - HT Candle is red\r\n//      - WT > 0 and crossed down\r\n\r\nstudy(title = 'VuManChu B Divergences', shorttitle = 'VMC Cipher_B_Divergences')\r\n\r\n// PARAMETERS {\r\n\r\n// WaveTrend\r\nwtShow = input(true, title = 'Show WaveTrend', type = input.bool, group = 'WaveTrend Settings')\r\nwtBuyShow = input(true, title = 'Show Buy dots', type = input.bool, group = 'WaveTrend Settings')\r\nwtGoldShow = input(true, title = 'Show Gold dots', type = input.bool, group = 'WaveTrend Settings')\r\nwtSellShow = input(true, title = 'Show Sell dots', type = input.bool, group = 'WaveTrend Settings')\r\nwtDivShow = input(true, title = 'Show Div. dots', type = input.bool, group = 'WaveTrend Settings')\r\nvwapShow = input(true, title = 'Show Fast WT', type = input.bool, group = 'WaveTrend Settings')\r\nwtChannelLen = input(9, title = 'WT Channel Length', type = input.integer, group = 'WaveTrend Settings')\r\nwtAverageLen = input(12, title = 'WT Average Length', type = input.integer, group = 'WaveTrend Settings')\r\nwtMASource = input(hlc3, title = 'WT MA Source', type = input.source, group = 'WaveTrend Settings')\r\nwtMALen = input(3, title = 'WT MA Length', type = input.integer, group = 'WaveTrend Settings')\r\n\r\n// WaveTrend Overbought & Oversold lines\r\nobLevel = input(53, title = 'WT Overbought Level 1', type = input.integer, group = 'WaveTrend Settings')\r\nobLevel2 = input(60, title = 'WT Overbought Level 2', type = input.integer, group = 'WaveTrend Settings')\r\nobLevel3 = input(100, title = 'WT Overbought Level 3', type = input.integer, group = 'WaveTrend Settings')\r\nosLevel = input(-53, title = 'WT Oversold Level 1', type = input.integer, group = 'WaveTrend Settings')\r\nosLevel2 = input(-60, title = 'WT Oversold Level 2', type = input.integer, group = 'WaveTrend Settings')\r\nosLevel3 = input(-75, title = 'WT Oversold Level 3', type = input.integer, group = 'WaveTrend Settings')\r\n\r\n// Divergence WT\r\nwtShowDiv = input(true, title = 'Show WT Regular Divergences', type = input.bool, group = 'WaveTrend Settings')\r\nwtShowHiddenDiv = input(false, title = 'Show WT Hidden Divergences', type = input.bool, group = 'WaveTrend Settings')\r\nshowHiddenDiv_nl = input(true, title = 'Not apply OB/OS Limits on Hidden Divergences', type = input.bool, group = 'WaveTrend Settings')\r\nwtDivOBLevel = input(45, title = 'WT Bearish Divergence min', type = input.integer, group = 'WaveTrend Settings')\r\nwtDivOSLevel = input(-65, title = 'WT Bullish Divergence min', type = input.integer, group = 'WaveTrend Settings')\r\n\r\n// Divergence extra range\r\nwtDivOBLevel_addshow = input(true, title = 'Show 2nd WT Regular Divergences', type = input.bool, group = 'WaveTrend Settings')\r\nwtDivOBLevel_add = input(15, title = 'WT 2nd Bearish Divergence', type = input.integer, group = 'WaveTrend Settings')\r\nwtDivOSLevel_add = input(-40, title = 'WT 2nd Bullish Divergence 15 min', type = input.integer, group = 'WaveTrend Settings')\r\n\r\n// RSI+MFI\r\nrsiMFIShow = input(true, title = 'Show MFI', type = input.bool, group = 'MFI Settings')\r\nrsiMFIperiod = input(60,title = 'MFI Period', type = input.integer, group = 'MFI Settings')\r\nrsiMFIMultiplier = input(150, title = 'MFI Area multiplier', type = input.float, group = 'MFI Settings')\r\nrsiMFIPosY = input(2.5, title = 'MFI Area Y Pos', type = input.float, group = 'MFI Settings')\r\n\r\n// RSI\r\nrsiShow = input(true, title = 'Show RSI', type = input.bool, group = 'RSI Settings')\r\nrsiSRC = input(close, title = 'RSI Source', type = input.source, group = 'RSI Settings')\r\nrsiLen = input(14, title = 'RSI Length', type = input.integer, group = 'RSI Settings')\r\nrsiOversold = input(30, title = 'RSI Oversold', minval = 50, maxval = 100, type = input.integer, group = 'RSI Settings')\r\nrsiOverbought = input(60, title = 'RSI Overbought', minval = 0, maxval = 50, type = input.integer, group = 'RSI Settings')\r\n\r\n// Divergence RSI\r\nrsiShowDiv = input(false, title = 'Show RSI Regular Divergences', type = input.bool, group = 'RSI Settings')\r\nrsiShowHiddenDiv = input(false, title = 'Show RSI Hidden Divergences', type = input.bool, group = 'RSI Settings')\r\nrsiDivOBLevel = input(60, title = 'RSI Bearish Divergence min', type = input.integer, group = 'RSI Settings')\r\nrsiDivOSLevel = input(30, title = 'RSI Bullish Divergence min', type = input.integer, group = 'RSI Settings')\r\n\r\n// RSI Stochastic\r\nstochShow = input(true, title = 'Show Stochastic RSI', type = input.bool, group = 'Stoch Settings')\r\nstochUseLog = input(true, title=' Use Log?', type = input.bool, group = 'Stoch Settings')\r\nstochAvg = input(false, title='Use Average of both K & D', type = input.bool, group = 'Stoch Settings')\r\nstochSRC = input(close, title = 'Stochastic RSI Source', type = input.source, group = 'Stoch Settings')\r\nstochLen = input(14, title = 'Stochastic RSI Length', type = input.integer, group = 'Stoch Settings')\r\nstochRsiLen = input(14, title = 'RSI Length ', type = input.integer, group = 'Stoch Settings')\r\nstochKSmooth = input(3, title = 'Stochastic RSI K Smooth', type = input.integer, group = 'Stoch Settings')\r\nstochDSmooth = input(3, title = 'Stochastic RSI D Smooth', type = input.integer, group = 'Stoch Settings')\r\n\r\n// Divergence stoch\r\nstochShowDiv = input(false, title = 'Show Stoch Regular Divergences', type = input.bool, group = 'Stoch Settings')\r\nstochShowHiddenDiv = input(false, title = 'Show Stoch Hidden Divergences', type = input.bool, group = 'Stoch Settings')\r\n\r\n// Schaff Trend Cycle\r\ntcLine = input(false, title=\"Show Schaff TC line\", type=input.bool, group = 'Schaff Settings')\r\ntcSRC = input(close, title = 'Schaff TC Source', type = input.source, group = 'Schaff Settings')\r\ntclength = input(10, title=\"Schaff TC\", type=input.integer, group = 'Schaff Settings')\r\ntcfastLength = input(23, title=\"Schaff TC Fast Lenght\", type=input.integer, group = 'Schaff Settings')\r\ntcslowLength = input(50, title=\"Schaff TC Slow Length\", type=input.integer, group = 'Schaff Settings')\r\ntcfactor = input(0.5, title=\"Schaff TC Factor\", type=input.float, group = 'Schaff Settings')\r\n\r\n// Sommi Flag\r\nsommiFlagShow = input(false, title = 'Show Sommi flag', type = input.bool, group = 'Sommi Settings')\r\nsommiShowVwap = input(false, title = 'Show Sommi F. Wave', type = input.bool, group = 'Sommi Settings')\r\nsommiVwapTF = input('720', title = 'Sommi F. Wave timeframe', type = input.string, group = 'Sommi Settings')\r\nsommiVwapBearLevel = input(0, title = 'F. Wave Bear Level (less than)', type = input.integer, group = 'Sommi Settings')\r\nsommiVwapBullLevel = input(0, title = 'F. Wave Bull Level (more than)', type = input.integer, group = 'Sommi Settings')\r\nsoomiFlagWTBearLevel = input(0, title = 'WT Bear Level (more than)', type = input.integer, group = 'Sommi Settings') \r\nsoomiFlagWTBullLevel = input(0, title = 'WT Bull Level (less than)', type = input.integer, group = 'Sommi Settings') \r\nsoomiRSIMFIBearLevel = input(0, title = 'Money flow Bear Level (less than)', type = input.integer, group = 'Sommi Settings') \r\nsoomiRSIMFIBullLevel = input(0, title = 'Money flow Bull Level (more than)', type = input.integer, group = 'Sommi Settings') \r\n\r\n// Sommi Diamond\r\nsommiDiamondShow = input(false, title = 'Show Sommi diamond', type = input.bool, group = 'Sommi Settings')\r\nsommiHTCRes = input('60', title = 'HTF Candle Res. 1', type = input.string, group = 'Sommi Settings')\r\nsommiHTCRes2 = input('240', title = 'HTF Candle Res. 2', type = input.string, group = 'Sommi Settings')\r\nsoomiDiamondWTBearLevel = input(0, title = 'WT Bear Level (More than)', type = input.integer, group = 'Sommi Settings')\r\nsoomiDiamondWTBullLevel = input(0, title = 'WT Bull Level (Less than)', type = input.integer, group = 'Sommi Settings')\r\n\r\n// macd Colors\r\nmacdWTColorsShow = input(false, title = 'Show MACD Colors', type = input.bool, group = 'MACD Settings')\r\nmacdWTColorsTF = input('240', title = 'MACD Colors MACD TF', type = input.string, group = 'MACD Settings')\r\n\r\ndarkMode = input(false, title = 'Dark mode', type = input.bool, group = 'Mode Settings')\r\n\r\n\r\n// Colors\r\ncolorRed = #ff0000\r\ncolorPurple = #e600e6\r\ncolorGreen = #3fff00\r\ncolorOrange = #e2a400\r\ncolorYellow = #ffe500\r\ncolorWhite = #ffffff\r\ncolorPink = #ff00f0\r\ncolorBluelight = #31c0ff\r\ncolorWT2 = #0d47a1\r\ncolorWT2_ = #131722\r\ncolormacdWT1a = #4caf58\r\ncolormacdWT1b = #af4c4c\r\ncolormacdWT1c = #7ee57e\r\ncolormacdWT1d = #ff3535\r\ncolormacdWT2a = #305630\r\ncolormacdWT2b = #310101\r\ncolormacdWT2c = #132213\r\ncolormacdWT2d = #770000\r\n\r\n// } PARAMETERS\r\n\r\n// FUNCTIONS {\r\n  \r\n// Divergences \r\nf_top_fractal(src) => src[4] < src[2] and src[3] < src[2] and src[2] > src[1] and src[2] > src[0]\r\nf_bot_fractal(src) => src[4] > src[2] and src[3] > src[2] and src[2] < src[1] and src[2] < src[0]\r\nf_fractalize(src) => f_top_fractal(src) ? 1 : f_bot_fractal(src) ? -1 : 0\r\n\r\nf_findDivs(src, topLimit, botLimit, useLimits) =>\r\n    fractalTop = f_fractalize(src) > 0 and (useLimits ? src[2] >= topLimit : true) ? src[2] : na\r\n    fractalBot = f_fractalize(src) < 0 and (useLimits ? src[2] <= botLimit : true) ? src[2] : na\r\n    highPrev = valuewhen(fractalTop, src[2], 0)[2]\r\n    highPrice = valuewhen(fractalTop, high[2], 0)[2]\r\n    lowPrev = valuewhen(fractalBot, src[2], 0)[2]\r\n    lowPrice = valuewhen(fractalBot, low[2], 0)[2]\r\n    bearSignal = fractalTop and high[2] > highPrice and src[2] < highPrev\r\n    bullSignal = fractalBot and low[2] < lowPrice and src[2] > lowPrev\r\n    bearDivHidden = fractalTop and high[2] < highPrice and src[2] > highPrev\r\n    bullDivHidden = fractalBot and low[2] > lowPrice and src[2] < lowPrev\r\n    [fractalTop, fractalBot, lowPrev, bearSignal, bullSignal, bearDivHidden, bullDivHidden]\r\n        \r\n// RSI+MFI\r\nf_rsimfi(_period, _multiplier, _tf) => security(syminfo.tickerid, _tf, sma(((close - open) / (high - low)) * _multiplier, _period) - rsiMFIPosY)\r\n   \r\n// WaveTrend\r\nf_wavetrend(src, chlen, avg, malen, tf) =>\r\n    tfsrc = security(syminfo.tickerid, tf, src)\r\n    esa = ema(tfsrc, chlen)\r\n    de = ema(abs(tfsrc - esa), chlen)\r\n    ci = (tfsrc - esa) / (0.015 * de)\r\n    wt1 = security(syminfo.tickerid, tf, ema(ci, avg))\r\n    wt2 = security(syminfo.tickerid, tf, sma(wt1, malen))\r\n    wtVwap = wt1 - wt2\r\n    wtOversold = wt2 <= osLevel\r\n    wtOverbought = wt2 >= obLevel\r\n    wtCross = cross(wt1, wt2)\r\n    wtCrossUp = wt2 - wt1 <= 0\r\n    wtCrossDown = wt2 - wt1 >= 0\r\n    wtCrosslast = cross(wt1[2], wt2[2])\r\n    wtCrossUplast = wt2[2] - wt1[2] <= 0\r\n    wtCrossDownlast = wt2[2] - wt1[2] >= 0\r\n    [wt1, wt2, wtOversold, wtOverbought, wtCross, wtCrossUp, wtCrossDown, wtCrosslast, wtCrossUplast, wtCrossDownlast, wtVwap]\r\n\r\n// Schaff Trend Cycle\r\nf_tc(src, length, fastLength, slowLength) =>\r\n    ema1 = ema(src, fastLength)\r\n    ema2 = ema(src, slowLength)\r\n    macdVal = ema1 - ema2\t\r\n    alpha = lowest(macdVal, length)\r\n    beta = highest(macdVal, length) - alpha\r\n    gamma = (macdVal - alpha) / beta * 100\r\n    gamma := beta > 0 ? gamma : nz(gamma[1])\r\n    delta = gamma\r\n    delta := na(delta[1]) ? delta : delta[1] + tcfactor * (gamma - delta[1])\r\n    epsilon = lowest(delta, length)\r\n    zeta = highest(delta, length) - epsilon\r\n    eta = (delta - epsilon) / zeta * 100\r\n    eta := zeta > 0 ? eta : nz(eta[1])\r\n    stcReturn = eta\r\n    stcReturn := na(stcReturn[1]) ? stcReturn : stcReturn[1] + tcfactor * (eta - stcReturn[1])\r\n    stcReturn\r\n\r\n// Stochastic RSI\r\nf_stochrsi(_src, _stochlen, _rsilen, _smoothk, _smoothd, _log, _avg) =>\r\n    src = _log ? log(_src) : _src\r\n    rsi = rsi(src, _rsilen)\r\n    kk = sma(stoch(rsi, rsi, rsi, _stochlen), _smoothk)\r\n    d1 = sma(kk, _smoothd)\r\n    avg_1 = avg(kk, d1)\r\n    k = _avg ? avg_1 : kk\r\n    [k, d1]\r\n\r\n// MACD\r\nf_macd(src, fastlen, slowlen, sigsmooth, tf) =>\r\n    fast_ma = security(syminfo.tickerid, tf, ema(src, fastlen))\r\n    slow_ma = security(syminfo.tickerid, tf, ema(src, slowlen))\r\n    macd = fast_ma - slow_ma,\r\n    signal = security(syminfo.tickerid, tf, sma(macd, sigsmooth))\r\n    hist = macd - signal\r\n    [macd, signal, hist]\r\n\r\n// MACD Colors on WT    \r\nf_macdWTColors(tf) =>\r\n    hrsimfi = f_rsimfi(rsiMFIperiod, rsiMFIMultiplier, tf)\r\n    [macd, signal, hist] = f_macd(close, 28, 42, 9, macdWTColorsTF)\r\n    macdup = macd >= signal\r\n    macddown = macd <= signal\r\n    macdWT1Color = macdup ? hrsimfi > 0 ? colormacdWT1c : colormacdWT1a : macddown ? hrsimfi < 0 ? colormacdWT1d : colormacdWT1b : na\r\n    macdWT2Color = macdup ? hrsimfi < 0 ? colormacdWT2c : colormacdWT2a : macddown ? hrsimfi < 0 ? colormacdWT2d : colormacdWT2b : na \r\n    [macdWT1Color, macdWT2Color]\r\n    \r\n// Get higher timeframe candle\r\nf_getTFCandle(_tf) => \r\n    _open  = security(heikinashi(syminfo.tickerid), _tf, open, barmerge.gaps_off, barmerge.lookahead_on)\r\n    _close = security(heikinashi(syminfo.tickerid), _tf, close, barmerge.gaps_off, barmerge.lookahead_on)\r\n    _high  = security(heikinashi(syminfo.tickerid), _tf, high, barmerge.gaps_off, barmerge.lookahead_on)\r\n    _low   = security(heikinashi(syminfo.tickerid), _tf, low, barmerge.gaps_off, barmerge.lookahead_on)\r\n    hl2   = (_high + _low) / 2.0\r\n    newBar = change(_open)\r\n    candleBodyDir = _close > _open\r\n    [candleBodyDir, newBar]\r\n\r\n// Sommi flag\r\nf_findSommiFlag(tf, wt1, wt2, rsimfi, wtCross, wtCrossUp, wtCrossDown) =>    \r\n    [hwt1, hwt2, hwtOversold, hwtOverbought, hwtCross, hwtCrossUp, hwtCrossDown, hwtCrosslast, hwtCrossUplast, hwtCrossDownlast, hwtVwap] = f_wavetrend(wtMASource, wtChannelLen, wtAverageLen, wtMALen, tf)      \r\n    \r\n    bearPattern = rsimfi < soomiRSIMFIBearLevel and\r\n                   wt2 > soomiFlagWTBearLevel and \r\n                   wtCross and \r\n                   wtCrossDown and \r\n                   hwtVwap < sommiVwapBearLevel\r\n                   \r\n    bullPattern = rsimfi > soomiRSIMFIBullLevel and \r\n                   wt2 < soomiFlagWTBullLevel and \r\n                   wtCross and \r\n                   wtCrossUp and \r\n                   hwtVwap > sommiVwapBullLevel\r\n    \r\n    [bearPattern, bullPattern, hwtVwap]\r\n    \r\nf_findSommiDiamond(tf, tf2, wt1, wt2, wtCross, wtCrossUp, wtCrossDown) =>\r\n    [candleBodyDir, newBar] = f_getTFCandle(tf)\r\n    [candleBodyDir2, newBar2] = f_getTFCandle(tf2)\r\n    bearPattern = wt2 >= soomiDiamondWTBearLevel and\r\n                   wtCross and\r\n                   wtCrossDown and\r\n                   not candleBodyDir and\r\n                   not candleBodyDir2                   \r\n    bullPattern = wt2 <= soomiDiamondWTBullLevel and\r\n                   wtCross and\r\n                   wtCrossUp and\r\n                   candleBodyDir and\r\n                   candleBodyDir2 \r\n    [bearPattern, bullPattern]\r\n \r\n// } FUNCTIONS  \r\n\r\n// CALCULATE INDICATORS {\r\n\r\n// RSI\r\nrsi = rsi(rsiSRC, rsiLen)\r\nrsiobcolor = input(color.new(#e13e3e, 0), 'RSI OverBought', group = 'Color Settings')\r\nrsioscolor = input(color.new(#3ee145, 0), 'RSI OverSold', group = 'Color Settings')\r\nrsinacolor = input(color.new(#c33ee1, 0), 'RSI InBetween', group = 'Color Settings')\r\nrsiColor = rsi <= rsiOversold ? rsioscolor : rsi >= rsiOverbought ? rsiobcolor : rsinacolor\r\n\r\n// RSI + MFI Area\r\nrsiMFI = f_rsimfi(rsiMFIperiod, rsiMFIMultiplier, timeframe.period)\r\nrsiMFIColorAbove = input(color.new(#3ee145, 0), 'MFI Color > 0', group = 'Color Settings')\r\nrsiMFIColorBelow = input(color.new(#ff3d2e, 0), 'MFI Color < 0', group = 'Color Settings')\r\nrsiMFIColor = rsiMFI > 0 ? rsiMFIColorAbove : rsiMFIColorBelow\r\n\r\n// Calculates WaveTrend\r\n[wt1, wt2, wtOversold, wtOverbought, wtCross, wtCrossUp, wtCrossDown, wtCross_last, wtCrossUp_last, wtCrossDown_last, wtVwap] = f_wavetrend(wtMASource, wtChannelLen, wtAverageLen, wtMALen, timeframe.period)\r\n \r\n// Stochastic RSI\r\n[stochK, stochD] = f_stochrsi(stochSRC, stochLen, stochRsiLen, stochKSmooth, stochDSmooth, stochUseLog, stochAvg)\r\n\r\n// Schaff Trend Cycle\r\ntcVal = f_tc(tcSRC, tclength, tcfastLength, tcslowLength)\r\n\r\n// Sommi flag\r\n[sommiBearish, sommiBullish, hvwap] = f_findSommiFlag(sommiVwapTF, wt1, wt2, rsiMFI, wtCross,  wtCrossUp, wtCrossDown)\r\n\r\n//Sommi diamond\r\n[sommiBearishDiamond, sommiBullishDiamond] = f_findSommiDiamond(sommiHTCRes, sommiHTCRes2, wt1, wt2, wtCross, wtCrossUp, wtCrossDown)\r\n\r\n// macd colors\r\n[macdWT1Color, macdWT2Color] = f_macdWTColors(macdWTColorsTF)\r\n\r\n// WT Divergences\r\n[wtFractalTop, wtFractalBot, wtLow_prev, wtBearDiv, wtBullDiv, wtBearDivHidden, wtBullDivHidden] = f_findDivs(wt2, wtDivOBLevel, wtDivOSLevel, true)\r\n    \r\n[wtFractalTop_add, wtFractalBot_add, wtLow_prev_add, wtBearDiv_add, wtBullDiv_add, wtBearDivHidden_add, wtBullDivHidden_add] =  f_findDivs(wt2, wtDivOBLevel_add, wtDivOSLevel_add, true)\r\n[wtFractalTop_nl, wtFractalBot_nl, wtLow_prev_nl, wtBearDiv_nl, wtBullDiv_nl, wtBearDivHidden_nl, wtBullDivHidden_nl] =  f_findDivs(wt2, 0, 0, false)\r\n\r\nwtBearDivHidden_ = showHiddenDiv_nl ? wtBearDivHidden_nl : wtBearDivHidden\r\nwtBullDivHidden_ = showHiddenDiv_nl ? wtBullDivHidden_nl : wtBullDivHidden\r\n\r\nWTBearDivColorDown = input(color.new(#e60000, 0), 'WT Bear Div', group = 'Color Settings') \r\nwtBullDivColorUp = input(color.new(#00e676, 0), 'WT Bull Div', group = 'Color Settings') \r\n\r\nwtBearDivColor = (wtShowDiv and wtBearDiv) or (wtShowHiddenDiv and wtBearDivHidden_) ? WTBearDivColorDown : na\r\nwtBullDivColor = (wtShowDiv and wtBullDiv) or (wtShowHiddenDiv and wtBullDivHidden_) ? wtBullDivColorUp : na\r\n\r\nwtBearDivColor_add = (wtShowDiv and (wtDivOBLevel_addshow and wtBearDiv_add)) or (wtShowHiddenDiv and (wtDivOBLevel_addshow and wtBearDivHidden_add)) ? WTBearDivColorDown: na\r\nwtBullDivColor_add = (wtShowDiv and (wtDivOBLevel_addshow and wtBullDiv_add)) or (wtShowHiddenDiv and (wtDivOBLevel_addshow and wtBullDivHidden_add)) ? wtBullDivColorUp : na\r\n\r\n// RSI Divergences\r\n[rsiFractalTop, rsiFractalBot, rsiLow_prev, rsiBearDiv, rsiBullDiv, rsiBearDivHidden, rsiBullDivHidden] = f_findDivs(rsi, rsiDivOBLevel, rsiDivOSLevel, true)\r\n[rsiFractalTop_nl, rsiFractalBot_nl, rsiLow_prev_nl, rsiBearDiv_nl, rsiBullDiv_nl, rsiBearDivHidden_nl, rsiBullDivHidden_nl] = f_findDivs(rsi, 0, 0, false)\r\n\r\nrsiBearDivHidden_ = showHiddenDiv_nl ? rsiBearDivHidden_nl : rsiBearDivHidden\r\nrsiBullDivHidden_ = showHiddenDiv_nl ? rsiBullDivHidden_nl : rsiBullDivHidden\r\n\r\nrsiBearColor = color.new(#e60000, 0) //input(color.new(#e60000, 0), 'RSI Bear Div', group = 'Color Settings')\r\nrsiBullColor = color.new(#38ff42, 0) //input(color.new(#38ff42, 0), 'RSI Bull Div', group = 'Color Settings')\r\n\r\nrsiBearDivColor = (rsiShowDiv and rsiBearDiv) or (rsiShowHiddenDiv and rsiBearDivHidden_) ? rsiBearColor : na\r\nrsiBullDivColor = (rsiShowDiv and rsiBullDiv) or (rsiShowHiddenDiv and rsiBullDivHidden_) ? rsiBullColor : na\r\n \r\n// Stoch Divergences\r\n[stochFractalTop, stochFractalBot, stochLow_prev, stochBearDiv, stochBullDiv, stochBearDivHidden, stochBullDivHidden] = f_findDivs(stochK, 0, 0, false)\r\n\r\nstochbearcolor = color.new(#e60000, 0) //input(color.new(#e60000, 0), 'Stoch Bear Div', group = 'Color Settings')\r\nstochbullcolor = color.new(#38ff42, 0) //input(color.new(#38ff42, 0), 'Stoch Bull Div', group = 'Color Settings')\r\n\r\nstochBearDivColor = (stochShowDiv and stochBearDiv) or (stochShowHiddenDiv and stochBearDivHidden) ? stochbearcolor : na\r\nstochBullDivColor = (stochShowDiv and stochBullDiv) or (stochShowHiddenDiv and stochBullDivHidden) ? stochbullcolor : na\r\n\r\n\r\n// Small Circles WT Cross\r\nsignalcolorup = input(color.new(#00e676, 0), 'WT Buy Dot', group = 'Color Settings')\r\nsignalcolordown = input(color.new(#ff5252, 0), 'WT Sell Dot', group = 'Color Settings')\r\n\r\nsignalColor = wt2 - wt1 > 0 ? signalcolordown : signalcolorup\r\n\r\n// Buy signal.\r\nbuySignal = wtCross and wtCrossUp and wtOversold\r\n\r\nbuySignalDiv = (wtShowDiv and wtBullDiv) or \r\n               (wtShowDiv and wtBullDiv_add) or \r\n               (stochShowDiv and stochBullDiv) or \r\n               (rsiShowDiv and rsiBullDiv)\r\n    \r\nbuySignalDiv_color = wtBullDiv ? colorGreen : \r\n                     wtBullDiv_add ? color.new(colorGreen, 60) : \r\n                     rsiShowDiv ? colorGreen : na\r\n\r\n// Sell signal\r\nsellSignal = wtCross and wtCrossDown and wtOverbought\r\n             \r\nsellSignalDiv = (wtShowDiv and wtBearDiv) or \r\n               (wtShowDiv and wtBearDiv_add) or\r\n               (stochShowDiv and stochBearDiv) or\r\n               (rsiShowDiv and rsiBearDiv)\r\n                    \r\nsellSignalDiv_color = wtBearDiv ? colorRed : \r\n                     wtBearDiv_add ? color.new(colorRed, 60) : \r\n                     rsiBearDiv ? colorRed : na\r\n\r\n// Gold Buy \r\nlastRsi = valuewhen(wtFractalBot, rsi[2], 0)[2]\r\nwtGoldBuy = ((wtShowDiv and wtBullDiv) or (rsiShowDiv and rsiBullDiv)) and\r\n           wtLow_prev <= osLevel3 and\r\n           wt2 > osLevel3 and\r\n           wtLow_prev - wt2 <= -5 and\r\n           lastRsi < 30           \r\n          \r\n// } CALCULATE INDICATORS\r\n\r\n\r\n// DRAW {\r\nbgcolor(darkMode ? color.new(#000000, 0) : na)\r\nzLine = plot(0, color = color.new(colorWhite, 50))\r\n\r\n//  MFI BAR\r\nrsiMfiBarTopLine = plot(rsiMFIShow ? -95 : na, title = 'MFI Bar TOP Line', transp = 100)\r\nrsiMfiBarBottomLine = plot(rsiMFIShow ? -99 : na, title = 'MFI Bar BOTTOM Line', transp = 100)\r\nfill(rsiMfiBarTopLine, rsiMfiBarBottomLine, title = 'MFI Bar Colors', color = rsiMFIColor, transp = 75)\r\n\r\n// WT Areas\r\ncolorWT1blue = input(color.new(#4994ec, 0), \"WT1 Fill\", group = 'Color Settings')\r\ncolorWT2purple = input(color.new(#1f1559, 0), 'WT2 Fill', group = 'Color Settings')\r\nplot(wtShow ? wt1 : na, style=plot.style_area, title='WT Wave 1', color=color.new(colorWT1blue, 30))\r\n\r\n// plot(wtShow ? wt2 : na, style=plot.style_area, title='WT Wave 2', color=darkMode ? color.new(colorWT2_,25) : color.new(colorWT2purple,25))\r\nplot(wtShow ? wt2 : na, style=plot.style_area, title='WT Wave 2', color = color.new(colorWT2purple,25))\r\n\r\n// VWAP\r\nVWAPColor = input(color.new(#ffffff, 50), \"VWAP\", group = 'Color Settings')\r\nplot(vwapShow ? wtVwap : na, title = 'VWAP', color = VWAPColor, style = plot.style_area, linewidth = 2, transp = 45)\r\n\r\n// MFI AREA\r\n// rsiMFIplot = plot(rsiMFIShow ? rsiMFI : na, title='RSI+MFI Area', color=color.new(rsiMFIColor,90))\r\n// fill(rsiMFIplot, zLine, color.new(rsiMFIColor,50))\r\nplot(rsiMFIShow ? rsiMFI : na, style=plot.style_area, title='rsiMFI', color = color.new(rsiMFIColor,50))\r\n\r\n\r\n// WT Div\r\n\r\nplot(series = wtFractalTop ? wt2[2] : na, title = 'WT Bearish Divergence', color = wtBearDivColor, linewidth = 2, offset = -2)\r\nplot(series = wtFractalBot ? wt2[2] : na, title = 'WT Bullish Divergence', color = wtBullDivColor, linewidth = 2, offset = -2)\r\n\r\n// WT 2nd Div\r\nplot(series = wtFractalTop_add ? wt2[2] : na, title = 'WT 2nd Bearish Divergence', color = wtBearDivColor_add, linewidth = 2, offset = -2)\r\nplot(series = wtFractalBot_add ? wt2[2] : na, title = 'WT 2nd Bullish Divergence', color = wtBullDivColor_add, linewidth = 2, offset = -2)\r\n\r\n// RSI\r\nplot(rsiShow ? rsi : na, title = 'RSI', color = rsiColor, linewidth = 2, transp = 25)\r\n\r\n// RSI Div\r\nplot(series = rsiFractalTop ? rsi[2] : na, title='RSI Bearish Divergence', color = rsiBearDivColor, linewidth = 1, offset = -2)\r\nplot(series = rsiFractalBot ? rsi[2] : na, title='RSI Bullish Divergence', color = rsiBullDivColor, linewidth = 1, offset = -2)\r\n\r\n// Stochastic RSI\r\nstochkcolor = input(color.new(#21baf3, 70), \"Stoch K\", group = 'Color Settings')\r\nstochdcolor = input(color.new(#673ab7, 90), \"Stoch D\", group = 'Color Settings')\r\n\r\nstochKplot = plot(stochShow ? stochK : na, title = 'Stoch K', color = stochkcolor, linewidth = 2)\r\nstochDplot = plot(stochShow ? stochD : na, title = 'Stoch D', color = stochdcolor, linewidth = 1)\r\nstochFillColor = stochK >= stochD ? color.new(#21baf3, 95) : color.new(#673ab7, 90)\r\nfill(stochKplot, stochDplot, title='KD Fill', color=stochFillColor)\r\n\r\n// Stoch Div\r\nplot(series = stochFractalTop ? stochK[2] : na, title='Stoch Bearish Divergence', color = stochBearDivColor, linewidth = 1, offset = -2)\r\nplot(series = stochFractalBot ? stochK[2] : na, title='Stoch Bullish Divergence', color = stochBullDivColor, linewidth = 1, offset = -2)\r\n\r\n// Schaff Trend Cycle\r\nplot(tcLine ? tcVal : na, color = color.new(#673ab7, 25), linewidth = 2, title = \"Schaff Trend Cycle 1\")\r\nplot(tcLine ? tcVal : na, color = color.new(colorWhite, 50), linewidth = 1, title = \"Schaff Trend Cycle 2\")\r\n\r\n\r\n// Draw Overbought & Oversold lines\r\noblvl2color = color.new(#ffffff, 0) //input(color.new(#ffffff, 0), \"OB LVL 2\", group = 'Color Settings')\r\noblvl3color = color.new(#ffffff, 0) //input(color.new(#ffffff, 0), \"OB LVL 3\", group = 'Color Settings')\r\noslvl2color = color.new(#ffffff, 0) //input(color.new(#ffffff, 0), \"OS LVL 2\", group = 'Color Settings')\r\n\r\n//plot(obLevel, title = 'Over Bought Level 1', color = colorWhite, linewidth = 1, style = plot.style_circles, transp = 85)\r\nplot(obLevel2, title = 'Over Bought Level 2', color = oblvl2color, linewidth = 1, style = plot.style_stepline, transp = 85)\r\nplot(obLevel3, title = 'Over Bought Level 3', color = oblvl3color, linewidth = 1, style = plot.style_circles, transp = 95)\r\n\r\n//plot(osLevel, title = 'Over Sold Level 1', color = colorWhite, linewidth = 1, style = plot.style_circles, transp = 85)\r\nplot(osLevel2, title = 'Over Sold Level 2', color = oslvl2color, linewidth = 1, style = plot.style_stepline, transp = 85)\r\n\r\n// Sommi flag\r\nplotchar(sommiFlagShow and sommiBearish ? 108 : na, title = 'Sommi bearish flag', char='⚑', color = colorPink, location = location.absolute, size = size.tiny, transp = 0)\r\nplotchar(sommiFlagShow and sommiBullish ? -108 : na, title = 'Sommi bullish flag', char='⚑', color = colorBluelight, location = location.absolute, size = size.tiny, transp = 0)\r\nplot(sommiShowVwap ? ema(hvwap, 3) : na, title = 'Sommi higher VWAP', color = colorYellow, linewidth = 2, style = plot.style_line, transp = 55)\r\n\r\n// Sommi diamond\r\nplotchar(sommiDiamondShow and sommiBearishDiamond ? 108 : na, title = 'Sommi bearish diamond', char='◆', color = colorPink, location = location.absolute, size = size.tiny, transp = 0)\r\nplotchar(sommiDiamondShow and sommiBullishDiamond ? -108 : na, title = 'Sommi bullish diamond', char='◆', color = colorBluelight, location = location.absolute, size = size.tiny, transp = 0)\r\n\r\n// Circles\r\nplot(wtCross ? wt2 : na, title = 'Buy and sell circle', color = signalColor, style = plot.style_circles, linewidth = 3, transp = 15)\r\n\r\nplotchar(wtBuyShow and buySignal ? -107 : na, title = 'Buy circle', char='·', color = colorGreen, location = location.absolute, size = size.small, transp = 50)\r\nplotchar(wtSellShow and sellSignal ? 105 : na , title = 'Sell circle', char='·', color = colorRed, location = location.absolute, size = size.small, transp = 50)\r\n\r\nplotchar(wtDivShow and buySignalDiv ? -106 : na, title = 'Divergence buy circle', char='•', color = buySignalDiv_color, location = location.absolute, size = size.small, offset = -2, transp = 15)\r\nplotchar(wtDivShow and sellSignalDiv ? 106 : na, title = 'Divergence sell circle', char='•', color = sellSignalDiv_color, location = location.absolute, size = size.small, offset = -2, transp = 15)\r\n\r\nplotchar(wtGoldBuy and wtGoldShow ? -106 : na, title = 'Gold  buy gold circle', char='•', color = colorOrange, location = location.absolute, size = size.normal, offset = -2, transp = 15)\r\n\r\n// } DRAW\r\n\r\n\r\n// ALERTS {\r\n  \r\n// BUY\r\nalertcondition(buySignal, 'Buy (Big green circle)', 'Green circle WaveTrend Oversold')\r\nalertcondition(buySignalDiv, 'Buy (Big green circle + Div)', 'Buy & WT Bullish Divergence & WT Overbought')\r\nalertcondition(wtGoldBuy, 'GOLD Buy (Big GOLDEN circle)', 'Green & GOLD circle WaveTrend Overbought')\r\nalertcondition(sommiBullish or sommiBullishDiamond, 'Sommi bullish flag/diamond', 'Blue flag/diamond')\r\nalertcondition(wtCross and wtCrossUp, 'Buy (Small green dot)', 'Buy small circle')\r\n\r\n// SELL\r\nalertcondition(sommiBearish or sommiBearishDiamond, 'Sommi bearish flag/diamond', 'Purple flag/diamond')\r\nalertcondition(sellSignal, 'Sell (Big red circle)', 'Red Circle WaveTrend Overbought')\r\nalertcondition(sellSignalDiv, 'Sell (Big red circle + Div)', 'Buy & WT Bearish Divergence & WT Overbought')\r\nalertcondition(wtCross and wtCrossDown, 'Sell (Small red dot)', 'Sell small circle')\r\n\r\n// } ALERTS","updated":"2023-10-23T15:55:04.212399Z","version":"17.0"}