{"extra":{},"lastVersionMaj":"-1.0","scriptAccess":"open_no_auth","scriptName":"MACD + SMA 200 Strategy (by ChartArt)","source":"//@version=2\r\nstrategy(\"MACD + SMA 200 Strategy (by ChartArt)\", shorttitle=\"CA_-_MACD_SMA_strategy\", overlay=true)\r\n\r\n// ChartArt's MACD + SMA 200 Strategy\r\n//\r\n// Version 1.0\r\n// Idea by ChartArt on November 30, 2015.\r\n//\r\n// Here is a combination of the MACD with the\r\n// slow moving average SMA 200 as a strategy.\r\n//\r\n// This strategy goes long if the MACD histogram\r\n// and the MACD momentum are both above zero and\r\n// the fast MACD moving average is above the\r\n// slow MACD moving average. As additional long filter\r\n// the recent price has to be above the SMA 200.\r\n// If the inverse logic is true, the strategy\r\n// goes short. For the worst case there is a\r\n// max intraday equity loss of 50% filter.\r\n\r\n\r\n// Input\r\nsource = input(close)\r\nfastLength = input(12, minval=1, title=\"MACD fast moving average\")\r\nslowLength=input(26,minval=1, title=\"MACD slow moving average\")\r\nsignalLength=input(9,minval=1, title=\"MACD signal line moving average\")\r\nveryslowLength=input(200,minval=1, title=\"Very slow moving average\")\r\nswitch1=input(true, title=\"Enable Bar Color?\")\r\nswitch2=input(true, title=\"Enable Moving Averages?\")\r\nswitch3=input(true, title=\"Enable Background Color?\")\r\n\r\n// Calculation\r\nfastMA = sma(source, fastLength)\r\nslowMA = sma(source, slowLength)\r\nveryslowMA = sma(source, veryslowLength)\r\nmacd = fastMA - slowMA\r\nsignal = sma(macd, signalLength)\r\nhist = macd - signal\r\n\r\n// Colors\r\nMAtrendcolor = change(veryslowMA) > 0 ? green : red\r\ntrendcolor = fastMA > slowMA and change(veryslowMA) > 0 and close > slowMA ? green : fastMA < slowMA and change(veryslowMA) < 0 and close < slowMA ? red : blue\r\nbartrendcolor = close > fastMA and close > slowMA and close > veryslowMA and change(slowMA) > 0 ? green : close < fastMA and close < slowMA and close < veryslowMA and change(slowMA) < 0 ? red : blue\r\nbackgroundcolor = slowMA > veryslowMA and crossover(hist, 0) and macd > 0 and fastMA > slowMA and close[slowLength] > veryslowMA ? green : slowMA < veryslowMA and crossunder(hist, 0) and macd < 0 and fastMA < slowMA and close[slowLength] < veryslowMA ? red : na\r\nbgcolor(switch3?backgroundcolor:na,transp=80)\r\nbarcolor(switch1?bartrendcolor:na)\r\n\r\n// Output\r\nF=plot(switch2?fastMA:na,color=trendcolor)\r\nS=plot(switch2?slowMA:na,color=trendcolor,linewidth=2)\r\nV=plot(switch2?veryslowMA:na,color=MAtrendcolor,linewidth=4)\r\nfill(F,V,color=gray)\r\n\r\n// Strategy\r\nbuyprice = low\r\nsellprice = high\r\ncancelLong = slowMA < veryslowMA\r\ncancelShort = slowMA > veryslowMA\r\n\r\nif (cancelLong)\r\n    strategy.cancel(\"MACDLE\")\r\n\r\nif crossover(hist, 0) and macd > 0 and fastMA > slowMA and close[slowLength] > veryslowMA \r\n    strategy.entry(\"MACDLE\", strategy.long, stop=buyprice, comment=\"Bullish\")\r\n\r\nif (cancelShort)\r\n    strategy.cancel(\"MACDSE\")\r\n\r\nif crossunder(hist, 0) and macd < 0 and fastMA < slowMA and close[slowLength] < veryslowMA \r\n    strategy.entry(\"MACDSE\", strategy.short, stop=sellprice, comment=\"Bearish\")\r\n\r\nmaxIdLossPcnt = input(50, \"Max Intraday Loss(%)\", type=float)\r\nstrategy.risk.max_intraday_loss(maxIdLossPcnt, strategy.percent_of_equity)\r\n\r\n//plot(strategy.equity, title=\"equity\", color=red, linewidth=2, style=areabr)","version":"-1.0"}