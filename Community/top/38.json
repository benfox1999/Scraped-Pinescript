{"created":"2020-02-18T23:58:00.18555Z","extra":{"kind":"study","sourceInputsCount":0},"lastVersionMaj":"4.0","scriptAccess":"open_no_auth","scriptName":"Scalping PullBack Tool R1.1 by JustUncleL","source":"//@version=4\r\n//\r\n\r\nstudy(title=\"Scalping PullBack Tool R1.1 by JustUncleL\", shorttitle=\"SCALPTOOL R1.1\", overlay=true)\r\n\r\n//\r\n// Revision:        1.1\r\n// Original Author: JustUncleL\r\n//\r\n// Description:\r\n//    This study project is a Scalping Pullback trading Tool that incorporates the majority of the indicators\r\n//    needed to analyse and scalp Trends for Pull Backs and reversals intended for lower time frame\r\n//    charts upto 15min, but it should work just as well on higher time frame charts for\r\n//    longer term trades.\r\n//\r\n//    This Tool can be used with Heikin Ashi (HA) candle charts or normal candle charts, HA candles\r\n//    will show a cleaner/smoother looking candle trend  but not show true prices.\r\n//\r\n//    Incorporated within this tool are the following indicators:\r\n//    1. Trader selectable important EMAs in an EMA style Ribbon: \r\n//       - Green = fast EMA (default=89)\r\n//       - Blue  = medium EMA (default=200) \r\n//       - Black = slow EMA (default=600)\r\n//    2. The PAC EMA (default=34) High/Low+Close creates the Price Action Channel (PAC).\r\n//    3. Fractals\r\n//    4. HH, LH, LL, HL finder may help with drawing Trend lines and mini Trend Lines.\r\n//    5. Coloured coded Bar high lighting based on the PAC: \r\n//       - blue = bar closed  above PAC\r\n//       - red  = bar closed below PAC\r\n//       - gray = bar closed inside PAC\r\n//       - red line = PAC EMA (34) of bar close\r\n//    6. Coloured chart Background to indicate Trend direction \r\n//       (NOTE: slow EMA(600) is not used in this Algo):\r\n//       - green  = Trend direction is up when PAC and fast EMA(89) are above medium EMA(200).\r\n//       - red    = Trend direction is down when PAC and fast EMA(89) are below medium EMA(200).\r\n//       - yellow = Trend direction is in transition.\r\n//    7. Pullback is defined as Price starts outside the PAC and then pulls back into the PAC\r\n//       closing the opposite side of the PAC centre line, then a recovery arrow can occur.\r\n//    8. Coloured Alert Arrows:\r\n//       - maroon down arrow  = Pullback recovery Sell alert\r\n//       - green up arrow     = Pullback recovery Buy alert\r\n//    9. Option to force Heikin Ashi candles in Algo calculations.\r\n//\r\n// Setup and hints:\r\n//\r\n//  - I also add \"Sweetspot Gold RN\" indicator to the chart as well to help with support and resistance\r\n//    finding and shows where the important \"00\" and \"0\" lines are.\r\n//  - When price is above the PAC(blue bars) we are only looking to buy as price comes back to the PAC\r\n//    When price is below the PAC(red bars), we are only looking to sell when price comes back to the PAC\r\n//  - What weâ€™re looking for when price comes back into the PAC we draw mini Trendlines (TL) uitilising the\r\n//    Fractals and HH/LL points to guide your TL drawing.\r\n//  - Now look for the trend to pull back and break the drawn mini TL. That's is where we can place the scalp\r\n//    trade.\r\n//  - So we are looking for continuation signals in terms of a strong, momentum driven pullbacks \r\n//    of the PAC EMA(34).\r\n//  - The other EMAs are there to check for other Pullbacks when PAC EMA (34) is broken.\r\n//  - Other than the \"SweetSpot Gold RN\" indicator, you should not need any other indicator to scalp \r\n//    for pullbacks.\r\n//  - If you want to trade shallower Pullbacks for quicker scalps, try reducing the \r\n//    PAC and EMA combination lengths for example:\r\n//      * 21 PAC and 55, 144, 377 for fast, medium, slow EMAs\r\n//      * 13 PAC and 34, 89, 233 for fast, medium, slow EMAs\r\n//  - Each alert should be evaluated on it's own merits, the alerts are designed to highlight possible\r\n//    scalping trades from Pullback recoveries around the PAC.\r\n//\r\n// References:\r\n//  - [RS]Fractals V8 by RicardoSantos\r\n//  - Price Action Trading System v0.3 by JustUncleL\r\n//  - SweetSpot Gold RN by JustUncleL\r\n//  - http://www.swing-trade-stocks.com/pullbacks.html\r\n//  - https://www.forexstrategiesresources.com/scalping-forex-strategies/106-1-min-scalping-with-34-exponential-moving-average-channel/\r\n//\r\n// Modifications:\r\n//  4-Feb-2020  Release R1.1 changes made to provide a more versitile tool\r\n//      - Upgraded to Pinescript R4\r\n//      - Reodered code into more logical blocks\r\n//      - Added option for PAC filtered Alerts and Alarms.\r\n//      - Added option to alter the default EMA lengths.\r\n//      - Added option to Show each EMA line.\r\n//      - Added option to use Heikin  Ashi candles for Algo calculations\r\n//        even when normal candles are displayed on chart.\r\n//\r\n\r\n// === INPUTS ===\r\nHiLoLen         = input(34, minval=2, title=\"High Low PAC channel Length\")\r\nfastEMAlength   = input(89, minval=2)\r\nmediumEMAlength = input(200, minval=2)\r\nslowEMAlength   = input(600, minval=2)\r\nShowFastEMA     = input(true)\r\nShowMediumEMA   = input(true)\r\nShowSlowEMA     = input(false)\r\nShowHHLL        = input(false)\r\nShowFractals    = input(true)\r\nfilterBW        = input(false, title=\"Show Ideal Fractals Only\")\r\nShowBarColor    = input(true, title=\"Show coloured Bars around PAC\")\r\nShowBuySell     = input(true, title=\"Show Buy/Sell Alert Arrows\")\r\nLookback        = input(3, minval=1, title=\"Pullback Lookback for PAC Cross Check\")\r\nDelayArrow      = input(false, title=\"Show Alert Arrows Only on Closed Candles\")\r\nDelay           = DelayArrow ? 1 : 0\r\nShowTrendBGcolor= input(true)\r\nUseHAcandles    = input(true, title=\"Use Heikin Ashi Candles in Algo Calculations\")\r\n//\r\n// === /INPUTS ===\r\n\r\n// === BASE FUNCTIONS ===\r\n\r\nhaClose = UseHAcandles ? security(heikinashi(syminfo.tickerid), timeframe.period, close) : close\r\nhaOpen  = UseHAcandles ? security(heikinashi(syminfo.tickerid), timeframe.period, open) : open\r\nhaHigh  = UseHAcandles ? security(heikinashi(syminfo.tickerid), timeframe.period, high) : high\r\nhaLow   = UseHAcandles ? security(heikinashi(syminfo.tickerid), timeframe.period, low) : low\r\n\r\n\r\n//  ||---   Fractal Recognition Functions:  ---------------------------------------------------------------||\r\nisRegularFractal(mode) =>\r\n    ret = mode == 1 ? high[4] < high[3] and high[3] < high[2] and high[2] > high[1] and \r\n       high[1] > high[0] : mode == -1 ? \r\n       low[4] > low[3] and low[3] > low[2] and low[2] < low[1] and low[1] < low[0] : \r\n       false\r\n    ret\r\n\r\nisBWFractal(mode) =>\r\n    ret = mode == 1 ? high[4] < high[2] and high[3] <= high[2] and high[2] >= high[1] and \r\n       high[2] > high[0] : mode == -1 ? \r\n       low[4] > low[2] and low[3] >= low[2] and low[2] <= low[1] and low[2] < low[0] : \r\n       false\r\n    ret\r\n//  ||-----------------------------------------------------------------------------------------------------||\r\n\r\n//\r\n// === /BASE FUNCTIONS ===\r\n\r\n// === SERIES SETUP ===\r\n//\r\n\r\n//  ||---   Setup Moving Averages and PAC channel:\r\n//  ||-----------------------------------------------------------------------------------------------------||\r\nfastEMA     = ema(haClose, fastEMAlength)\r\nmediumEMA   = ema(haClose, mediumEMAlength)\r\nslowEMA     = ema(haClose, slowEMAlength)\r\npacC        = ema(haClose, HiLoLen)\r\npacL        = ema(haLow, HiLoLen)\r\npacU        = ema(haHigh, HiLoLen)\r\nTrendDirection = fastEMA > mediumEMA and pacL > mediumEMA ? 1 : \r\n   fastEMA < mediumEMA and pacU < mediumEMA ? -1 : 0\r\n\r\n//  ||---   Fractal Recognition:\r\n//  ||-----------------------------------------------------------------------------------------------------||\r\nfilteredtopf = filterBW ? isRegularFractal(1) : isBWFractal(1)\r\nfilteredbotf = filterBW ? isRegularFractal(-1) : isBWFractal(-1)\r\n//  ||-----------------------------------------------------------------------------------------------------||\r\n//  ||---   Higher Highs, Lower Highs, Higher Lows, Lower Lows  -------------------------------------------||\r\nvaluewhen_H0 = valuewhen(filteredtopf == true, high[2], 0)\r\nvaluewhen_H1 = valuewhen(filteredtopf == true, high[2], 1)\r\nvaluewhen_H2 = valuewhen(filteredtopf == true, high[2], 2)\r\n//\r\nhigherhigh = filteredtopf == false ? false : \r\n   valuewhen_H1 < valuewhen_H0 and valuewhen_H2 < valuewhen_H0\r\nlowerhigh = filteredtopf == false ? false : \r\n   valuewhen_H1 > valuewhen_H0 and valuewhen_H2 > valuewhen_H0\r\nvaluewhen_L0 = valuewhen(filteredbotf == true, low[2], 0)\r\nvaluewhen_L1 = valuewhen(filteredbotf == true, low[2], 1)\r\nvaluewhen_L2 = valuewhen(filteredbotf == true, low[2], 2)\r\n//\r\nhigherlow = filteredbotf == false ? false : \r\n   valuewhen_L1 < valuewhen_L0 and valuewhen_L2 < valuewhen_L0\r\nlowerlow = filteredbotf == false ? false : \r\n   valuewhen_L1 > valuewhen_L0 and valuewhen_L2 > valuewhen_L0\r\n\r\n//\r\n// === /SERIES ===\r\n\r\n//\r\n// === PLOTTING ===\r\n// \r\n// Plot the Price Action Channel (PAC) base on EMA high,low and close\r\nL = plot(pacL, color=color.gray, linewidth=1, title=\"High PAC EMA\", transp=50)\r\nU = plot(pacU, color=color.gray, linewidth=1, title=\"Low PAC EMA\", transp=50)\r\nC = plot(pacC, color=color.red, linewidth=2, title=\"Close PAC EMA\", transp=0)\r\nfill(L, U, color=color.gray, transp=90, title=\"Fill HiLo PAC\")\r\n\r\n// Colour bars according to the close position relative to the PAC selected.\r\nBARcolor = haClose > pacU ? color.blue : haClose < pacL ? color.red : color.gray\r\nbarcolor(ShowBarColor ? BARcolor : na, title=\"Bar Colours\")\r\n//\r\nBGcolor = TrendDirection == 1 ? color.green : \r\n   TrendDirection == -1 ? color.red : color.yellow\r\nbgcolor(ShowTrendBGcolor ? BGcolor : na, transp=90, title=\"Trend BG Color\")\r\n\r\n// Draw the EMA ribbon\r\nplot(ShowFastEMA ? fastEMA : na, color=color.green, linewidth=2, transp=20, title=\"fastEMA\")\r\nplot(ShowMediumEMA ? mediumEMA : na, color=color.blue, linewidth=3, transp=20, title=\"mediumEMA\")\r\nplot(ShowSlowEMA ? slowEMA : na, color=color.black, linewidth=4, transp=20, title=\"slowEMA\")\r\n//\r\nplotshape(ShowFractals ? filteredtopf : na, title='Filtered Top Fractals', style=shape.triangledown, location=location.abovebar, color=color.red, offset=-2)\r\nplotshape(ShowFractals ? filteredbotf : na, title='Filtered Bottom Fractals', style=shape.triangleup, location=location.belowbar, color=color.lime, offset=-2)\r\n//\r\nplotshape(ShowHHLL ? higherhigh : na, title='Higher High', style=shape.square, location=location.abovebar, color=color.maroon, text=\"[HH]\", offset=-2)\r\nplotshape(ShowHHLL ? lowerhigh : na, title='Lower High', style=shape.square, location=location.abovebar, color=color.maroon, text=\"[LH]\", offset=-2)\r\nplotshape(ShowHHLL ? higherlow : na, title='High Low', style=shape.square, location=location.belowbar, color=color.green, text=\"[HL]\", offset=-2)\r\nplotshape(ShowHHLL ? lowerlow : na, title='Lower Low', style=shape.square, location=location.belowbar, color=color.green, text=\"[LL]\", offset=-2)\r\n//\r\n// === /PLOTTING ===\r\n\r\n\r\n// === ALERTING ===\r\n//\r\n\r\n// Initialise Trading state.\r\nTradeDirection = 0\r\nTradeDirection := nz(TradeDirection[1])\r\n//\r\npacExitU = haOpen < pacU and haClose > pacU and barssince(haClose<pacC)<=Lookback\r\npacExitL = haOpen > pacL and haClose < pacL and barssince(haClose>pacC)<=Lookback\r\nplotshape(barssince(haClose<pacC),color=na,location=location.bottom,title=\"barssince(haClose<pacC)\")\r\nplotshape(barssince(close>pacC),color=na,location=location.bottom,title=\"barssince(haClose>pacC)\")\r\n//\r\nBuy = TrendDirection == 1 and pacExitU\r\nSell = TrendDirection == -1 and pacExitL\r\n//\r\n// Keep Current trading state until Pullback occurs or New Recovery.\r\nTradeDirection := TradeDirection == 1 and haClose<pacC ? 0 : \r\n   TradeDirection == -1 and haClose>pacC ? 0 : \r\n   TradeDirection == 0 and Buy ? 1 : \r\n   TradeDirection == 0 and Sell ? -1 : TradeDirection\r\n\r\n// Show buy/sell arrows\r\nplotarrow(ShowBuySell and nz(TradeDirection[1+Delay]) == 0 and TradeDirection[Delay] != 0 ? TradeDirection[Delay] : na, offset=-Delay, \r\n          colorup=color.green, colordown=color.maroon, transp=20, minheight=20, maxheight=50, title=\"Buy/Sell Arrow\")\r\n//\r\n// Create alerts for TradingView Alarm subsystem.\r\nLong = nz(TradeDirection[1]) == 0 and TradeDirection == 1\r\nShort = nz(TradeDirection[1]) == 0 and TradeDirection == -1\r\nalertcondition(Long, title=\"Buy Condition\", message=\"BUY\")\r\nalertcondition(Short, title=\"Sell Condition\", message=\"SELL\")\r\n//\r\n// === /ALERTING ===\r\n\r\n// === eof.","updated":"2020-02-18T23:58:00.18555Z","version":"4.0"}