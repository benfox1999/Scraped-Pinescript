{"created":"2020-11-03T14:47:06.90391Z","extra":{"kind":"study","sourceInputsCount":0},"lastVersionMaj":"5.0","scriptAccess":"open_no_auth","scriptName":"Order Block Finder","source":"// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/\r\n// Â© wugamlo\r\n\r\n\r\n// This experimental Indicator helps identifying instituational Order Blocks. \r\n// Often these blocks signal the beginning of a strong move, but there is a significant probability that these price levels will be revisited at a later point in time again. \r\n// Therefore these are interesting levels to place limit orders (Buy Orders for Bullish OB / Sell Orders for Bearish OB). \r\n//\r\n// A Bullish Order block is defined as the last down candle before a sequence of up candles. (Relevant price range \"Open\" to \"Low\" is marked)  / Optionally full range \"High\" to \"Low\"\r\n// A Bearish Order Block is defined as the last up candle before a sequence of down candles. (Relevant price range \"Open\" to \"High\" is marked) / Optionally full range \"High\" to \"Low\"\r\n//\r\n// In the settings the number of required sequential candles can be adjusted. \r\n// Furthermore a %-threshold can be entered. It defines which %-change the sequential move needs to achieve in order to identify a relevant Order Block. \r\n// Channels for the last Bullish/Bearish Block can be shown/hidden.\r\n//\r\n// In addition to the upper/lower limits of each Order Block, also the equlibrium (average value) is marked as this is an interesting area for price interaction.\r\n//\r\n// Alerts added: Alerts fire when an Order Block is detected. The delay is based on the \"Relevant Periods\" input. Means with the default setting \"5\" the alert will trigger after the \r\n// number of consecutive candles is reached.\r\n\r\n\r\n\r\n//@version=4\r\nstudy(\"Order Block Finder\", overlay = true)               \r\n\r\ncolors    = input(title = \"Color Scheme\", defval=\"DARK\", options=[\"DARK\", \"BRIGHT\"])\r\nperiods   = input(5,     \"Relevant Periods to identify OB\")                // Required number of subsequent candles in the same direction to identify Order Block\r\nthreshold = input(0.0,   \"Min. Percent move to identify OB\", step = 0.1)   // Required minimum % move (from potential OB close to last subsequent candle to identify Order Block)\r\nusewicks  = input(false, \"Use whole range [High/Low] for OB marking?\" )    // Display High/Low range for each OB instead of Open/Low for Bullish / Open/High for Bearish\r\nshowbull  = input(true,  \"Show latest Bullish Channel?\")                   // Show Channel for latest Bullish OB?\r\nshowbear  = input(true,  \"Show latest Bearish Channel?\")                   // Show Channel for latest Bearish OB?\r\nshowdocu  = input(false, \"Show Label for documentation tooltip?\")          // Show Label which shows documentation as tooltip?\r\ninfo_pan  = input(false, \"Show Latest OB Panel?\")                          // Show Info Panel with latest OB Stats\r\n\r\nob_period = periods + 1                                                    // Identify location of relevant Order Block candle\r\nabsmove   = ((abs(close[ob_period] - close[1]))/close[ob_period]) * 100    // Calculate absolute percent move from potential OB to last candle of subsequent candles\r\nrelmove   = absmove >= threshold                                           // Identify \"Relevant move\" by comparing the absolute move to the threshold\r\n\r\n// Color Scheme\r\nbullcolor = colors == \"DARK\"? color.white : color.green\r\nbearcolor = colors == \"DARK\"? color.blue : color.red\r\n\r\n// Bullish Order Block Identification\r\nbullishOB = close[ob_period] < open[ob_period]                             // Determine potential Bullish OB candle (red candle)\r\n\r\nint upcandles  = 0\r\nfor i = 1 to periods\r\n    upcandles := upcandles + (close[i] > open[i]? 1 : 0)                   // Determine color of subsequent candles (must all be green to identify a valid Bearish OB)\r\n\r\nOB_bull      = bullishOB and (upcandles == (periods)) and relmove          // Identification logic (red OB candle & subsequent green candles)\r\nOB_bull_high = OB_bull? usewicks? high[ob_period] : open[ob_period] : na   // Determine OB upper limit (Open or High depending on input)\r\nOB_bull_low  = OB_bull? low[ob_period]  : na                               // Determine OB lower limit (Low)\r\nOB_bull_avg  = (OB_bull_high + OB_bull_low)/2                              // Determine OB middle line\r\n\r\n\r\n// Bearish Order Block Identification\r\nbearishOB = close[ob_period] > open[ob_period]                             // Determine potential Bearish OB candle (green candle)\r\n\r\nint downcandles  = 0\r\nfor i = 1 to periods\r\n    downcandles := downcandles + (close[i] < open[i]? 1 : 0)               // Determine color of subsequent candles (must all be red to identify a valid Bearish OB)\r\n\r\nOB_bear      = bearishOB and (downcandles == (periods)) and relmove        // Identification logic (green OB candle & subsequent green candles)\r\nOB_bear_high = OB_bear? high[ob_period] : na                               // Determine OB upper limit (High)\r\nOB_bear_low  = OB_bear? usewicks? low[ob_period] : open[ob_period] : na    // Determine OB lower limit (Open or Low depending on input)\r\nOB_bear_avg  = (OB_bear_low + OB_bear_high)/2                              // Determine OB middle line\r\n\r\n\r\n// Plotting\r\n\r\nplotshape(OB_bull, title=\"Bullish OB\", style = shape.triangleup,   color = bullcolor, textcolor = bullcolor, size = size.tiny, location = location.belowbar, offset = -ob_period, text = \"Bullish OB\")     // Bullish OB Indicator\r\nbull1 = plot(OB_bull_high, title=\"Bullish OB High\", style = plot.style_linebr, color = bullcolor, offset = -ob_period, linewidth = 3)                                               // Bullish OB Upper Limit\r\nbull2 = plot(OB_bull_low,  title=\"Bullish OB Low\",  style = plot.style_linebr, color = bullcolor, offset = -ob_period, linewidth = 3)                                               // Bullish OB Lower Limit\r\nfill(bull1, bull2, color=bullcolor, transp = 0, title = \"Bullish OB fill\")                                                                                                          // Fill Bullish OB\r\nplotshape(OB_bull_avg, title=\"Bullish OB Average\", style = shape.cross,   color = bullcolor, size = size.normal, location = location.absolute, offset = -ob_period)                 // Bullish OB Average\r\n\r\n\r\nplotshape(OB_bear, title=\"Bearish OB\", style = shape.triangledown, color = bearcolor, textcolor = bearcolor,  size = size.tiny, location = location.abovebar, offset = -ob_period, text = \"Bearish OB\")     // Bearish OB Indicator\r\nbear1 = plot(OB_bear_low,  title=\"Bearish OB Low\",  style = plot.style_linebr, color = bearcolor, offset = -ob_period, linewidth = 3)                                                // Bearish OB Lower Limit\r\nbear2 = plot(OB_bear_high, title=\"Bearish OB High\", style = plot.style_linebr, color = bearcolor, offset = -ob_period, linewidth = 3)                                                // Bearish OB Upper Limit\r\nfill(bear1, bear2, color=bearcolor, transp = 0, title = \"Bearish OB fill\")                                                                                                           // Fill Bearish OB\r\nplotshape(OB_bear_avg, title=\"Bearish OB Average\", style = shape.cross,   color = bearcolor, size = size.normal, location = location.absolute, offset = -ob_period)                  // Bullish OB Average\r\n\r\nvar line linebull1 = na       // Bullish OB average \r\nvar line linebull2 = na       // Bullish OB open\r\nvar line linebull3 = na       // Bullish OB low\r\nvar line linebear1 = na       // Bearish OB average\r\nvar line linebear2 = na       // Bearish OB high\r\nvar line linebear3 = na       // Bearish OB open\r\n\r\n\r\nif OB_bull and showbull\r\n    line.delete(linebull1)\r\n    linebull1 := line.new(x1 = bar_index, y1 = OB_bull_avg, x2 = bar_index - 1, y2 = OB_bull_avg, extend = extend.left, color = bullcolor, style = line.style_solid, width = 1)\r\n    \r\n    line.delete(linebull2)\r\n    linebull2 := line.new(x1 = bar_index, y1 = OB_bull_high, x2 = bar_index - 1, y2 = OB_bull_high, extend = extend.left, color = bullcolor, style = line.style_dashed, width = 1)\r\n    \r\n    line.delete(linebull3)\r\n    linebull3 := line.new(x1 = bar_index, y1 = OB_bull_low, x2 = bar_index - 1, y2 = OB_bull_low, extend = extend.left, color = bullcolor, style = line.style_dashed, width = 1)\r\n\r\nif OB_bear and showbear\r\n    line.delete(linebear1)\r\n    linebear1 := line.new(x1 = bar_index, y1 = OB_bear_avg, x2 = bar_index - 1, y2 = OB_bear_avg, extend = extend.left, color = bearcolor,  style = line.style_solid, width = 1)\r\n    \r\n    line.delete(linebear2)\r\n    linebear2 := line.new(x1 = bar_index, y1 = OB_bear_high, x2 = bar_index - 1, y2 = OB_bear_high, extend = extend.left, color = bearcolor,  style = line.style_dashed, width = 1)\r\n    \r\n    line.delete(linebear3)\r\n    linebear3 := line.new(x1 = bar_index, y1 = OB_bear_low, x2 = bar_index - 1, y2 = OB_bear_low, extend = extend.left, color = bearcolor,  style = line.style_dashed, width = 1)\r\n\r\n\r\n// Alerts for Order Blocks Detection\r\n\r\nalertcondition(OB_bull, title='New Bullish OB detected', message='New Bullish OB detected - This is NOT a BUY signal!')\r\nalertcondition(OB_bear, title='New Bearish OB detected', message='New Bearish OB detected - This is NOT a SELL signal!')\r\n\r\n// Print latest Order Blocks in Data Window\r\n\r\nvar latest_bull_high = 0.0         // Variable to keep latest Bull OB high\r\nvar latest_bull_avg  = 0.0         // Variable to keep latest Bull OB average\r\nvar latest_bull_low  = 0.0         // Variable to keep latest Bull OB low\r\nvar latest_bear_high = 0.0         // Variable to keep latest Bear OB high\r\nvar latest_bear_avg  = 0.0         // Variable to keep latest Bear OB average\r\nvar latest_bear_low  = 0.0         // Variable to keep latest Bear OB low\r\n\r\n// Assign latest values to variables\r\nif OB_bull_high > 0\r\n    latest_bull_high := OB_bull_high\r\n\r\nif OB_bull_avg > 0\r\n    latest_bull_avg := OB_bull_avg\r\n\r\nif OB_bull_low > 0\r\n    latest_bull_low := OB_bull_low\r\n\r\nif OB_bear_high > 0\r\n    latest_bear_high := OB_bear_high\r\n    \r\nif OB_bear_avg > 0\r\n    latest_bear_avg := OB_bear_avg\r\n    \r\nif OB_bear_low > 0\r\n    latest_bear_low := OB_bear_low\r\n\r\n// Plot invisible characters to be able to show the values in the Data Window\r\nplotchar(latest_bull_high, char = ' ', location = location.abovebar, color = #777777, transp = 100, size = size.tiny, title = \"Latest Bull High\")\r\nplotchar(latest_bull_avg,  char = ' ', location = location.abovebar, color = #777777, transp = 100, size = size.tiny, title = \"Latest Bull Avg\")\r\nplotchar(latest_bull_low,  char = ' ', location = location.abovebar, color = #777777, transp = 100, size = size.tiny, title = \"Latest Bull Low\")\r\nplotchar(latest_bear_high, char = ' ', location = location.abovebar, color = #777777, transp = 100, size = size.tiny, title = \"Latest Bear High\")\r\nplotchar(latest_bear_avg,  char = ' ', location = location.abovebar, color = #777777, transp = 100, size = size.tiny, title = \"Latest Bear Avg\")\r\nplotchar(latest_bear_low,  char = ' ', location = location.abovebar, color = #777777, transp = 100, size = size.tiny, title = \"Latest Bear Low\")\r\n\r\n\r\n//InfoPanel for latest Order Blocks\r\n\r\ndraw_InfoPanel(_text, _x, _y, font_size)=>\r\n    var label la_panel = na\r\n    label.delete(la_panel)\r\n    la_panel := label.new(\r\n         x=_x, y=_y, \r\n         text=_text, xloc=xloc.bar_time, yloc=yloc.price, \r\n         color=color.new(#383838, 5), style=label.style_label_left, textcolor=color.white, size=font_size)\r\n\r\ninfo_panel_x = time_close + round(change(time) * 100)\r\ninfo_panel_y = close\r\n\r\ntitle = \"LATEST ORDER BLOCKS\"\r\nrow0 = \"-----------------------------------------------------\"\r\nrow1 = ' Bullish - High: ' + tostring(latest_bull_high, '#.##')\r\nrow2 = ' Bullish - Avg: ' + tostring(latest_bull_avg, '#.##')\r\nrow3 = ' Bullish - Low: ' + tostring(latest_bull_low, '#.##')\r\nrow4 = \"-----------------------------------------------------\"\r\nrow5 = ' Bearish - High: ' + tostring(latest_bear_high, '#.##')\r\nrow6 = ' Bearish - Avg: ' + tostring(latest_bear_avg, '#.##')\r\nrow7 = ' Bearish - Low: ' + tostring(latest_bear_low, '#.##')\r\n\r\npanel_text = '\\n' + title + '\\n' + row0 + '\\n' + row1 + '\\n' + row2 + '\\n' + row3 + '\\n' + row4 + '\\n\\n' + row5 + '\\n' + row6 + '\\n' + row7 + '\\n'\r\n\r\nif info_pan\r\n    draw_InfoPanel(panel_text, info_panel_x, info_panel_y, size.normal)\r\n\r\n\r\n// === Label for Documentation/Tooltip ===\r\nchper = time - time[1]\r\nchper := change(chper) > 0 ? chper[1] : chper\r\n\r\n// === Tooltip text ===\r\n\r\nvar vartooltip = \"Indicator to help identifying instituational Order Blocks. Often these blocks signal the beginning of a strong move, but there is a high probability, that these prices will be revisited at a later point in time again and therefore are interesting levels to place limit orders. \\nBullish Order block is the last down candle before a sequence of up candles. \\nBearish Order Block is the last up candle before a sequence of down candles. \\nIn the settings the number of required sequential candles can be adjusted. \\nFurthermore a %-threshold can be entered which the sequential move needs to achieve in order to validate a relevant Order Block. \\nChannels for the last Bullish/Bearish Block can be shown/hidden.\"\r\n\r\n// === Print Label ===\r\nvar label l_docu = na\r\nlabel.delete(l_docu)\r\n\r\nif showdocu\r\n    l_docu := label.new(x = time + chper * 35, y = close, text = \"DOCU OB\", color=color.gray, textcolor=color.white, style=label.style_label_center, xloc = xloc.bar_time, yloc=yloc.price, size=size.tiny, textalign = text.align_left, tooltip = vartooltip)\r\n\r\n","updated":"2020-11-03T14:47:06.90391Z","version":"5.0"}