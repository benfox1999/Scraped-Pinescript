{"created":"2021-02-16T22:48:24.439866Z","extra":{"isMTFResolution":true,"kind":"study","sourceInputsCount":1},"lastVersionMaj":"3.0","scriptAccess":"open_no_auth","scriptName":"Profit Maximizer","source":"//@version=4\r\n// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/\r\n// Â© KivancOzbilgic\r\n//developer: @KivancOzbilgic\r\n//author: @KivancOzbilgic\r\n\r\nstudy(\"Profit Maximizer\",\"PMax\", overlay=true, format=format.price, precision=2, resolution=\"\")\r\nsrc = input(hl2, title=\"Source\")\r\nPeriods = input(title=\"ATR Length\", type=input.integer, defval=10)\r\nMultiplier = input(title=\"ATR Multiplier\", type=input.float, step=0.1, defval=3.0)\r\nmav = input(title=\"Moving Average Type\", defval=\"EMA\", options=[\"SMA\", \"EMA\", \"WMA\", \"TMA\", \"VAR\", \"WWMA\", \"ZLEMA\", \"TSF\"])\r\nlength =input(10, \"Moving Average Length\", minval=1)\r\nchangeATR= input(title=\"Change ATR Calculation Method ?\", type=input.bool, defval=true)\r\nNormalize= input(title=\"Normalize ATR ?\", type=input.bool, defval=false)\r\nshowsupport = input(title=\"Show Moving Average?\", type=input.bool, defval=true)\r\nshowsignalsk = input(title=\"Show Crossing Signals?\", type=input.bool, defval=true)\r\nshowsignalsc = input(title=\"Show Price/Pmax Crossing Signals?\", type=input.bool, defval=false)\r\nhighlighting = input(title=\"Highlighter On/Off ?\", type=input.bool, defval=true)\r\natr2 = sma(tr, Periods)\r\natr= changeATR ? atr(Periods) : atr2\r\nvalpha=2/(length+1)\r\nvud1=src>src[1] ? src-src[1] : 0\r\nvdd1=src<src[1] ? src[1]-src : 0\r\nvUD=sum(vud1,9)\r\nvDD=sum(vdd1,9)\r\nvCMO=nz((vUD-vDD)/(vUD+vDD))\r\nVAR=0.0\r\nVAR:=nz(valpha*abs(vCMO)*src)+(1-valpha*abs(vCMO))*nz(VAR[1])\r\nwwalpha = 1/ length\r\nWWMA = 0.0\r\nWWMA := wwalpha*src + (1-wwalpha)*nz(WWMA[1])\r\nzxLag = length/2==round(length/2) ? length/2 : (length - 1) / 2\r\nzxEMAData = (src + (src - src[zxLag]))\r\nZLEMA = ema(zxEMAData, length)\r\nlrc = linreg(src, length, 0)\r\nlrc1 = linreg(src,length,1)\r\nlrs = (lrc-lrc1)\r\nTSF = linreg(src, length, 0)+lrs\r\ngetMA(src, length) =>\r\n    ma = 0.0\r\n    if mav == \"SMA\"\r\n        ma := sma(src, length)\r\n        ma\r\n\r\n    if mav == \"EMA\"\r\n        ma := ema(src, length)\r\n        ma\r\n\r\n    if mav == \"WMA\"\r\n        ma := wma(src, length)\r\n        ma\r\n\r\n    if mav == \"TMA\"\r\n        ma := sma(sma(src, ceil(length / 2)), floor(length / 2) + 1)\r\n        ma\r\n\r\n    if mav == \"VAR\"\r\n        ma := VAR\r\n        ma\r\n\r\n    if mav == \"WWMA\"\r\n        ma := WWMA\r\n        ma\r\n\r\n    if mav == \"ZLEMA\"\r\n        ma := ZLEMA\r\n        ma\r\n\r\n    if mav == \"TSF\"\r\n        ma := TSF\r\n        ma\r\n    ma\r\n    \r\nMAvg=getMA(src, length)\r\nlongStop = Normalize ? MAvg - Multiplier*atr/close : MAvg - Multiplier*atr\r\nlongStopPrev = nz(longStop[1], longStop)\r\nlongStop := MAvg > longStopPrev ? max(longStop, longStopPrev) : longStop\r\nshortStop = Normalize ? MAvg + Multiplier*atr/close : MAvg + Multiplier*atr\r\nshortStopPrev = nz(shortStop[1], shortStop)\r\nshortStop := MAvg < shortStopPrev ? min(shortStop, shortStopPrev) : shortStop\r\ndir = 1\r\ndir := nz(dir[1], dir)\r\ndir := dir == -1 and MAvg > shortStopPrev ? 1 : dir == 1 and MAvg < longStopPrev ? -1 : dir\r\nPMax = dir==1 ? longStop: shortStop\r\nplot(showsupport ? MAvg : na, color=#0585E1, linewidth=2, title=\"Moving Avg Line\")\r\npALL=plot(PMax, color=color.red, linewidth=2, title=\"PMax\", transp=0)\r\nalertcondition(cross(MAvg, PMax), title=\"Cross Alert\", message=\"PMax - Moving Avg Crossing!\")\r\nalertcondition(crossover(MAvg, PMax), title=\"Crossover Alarm\", message=\"Moving Avg BUY SIGNAL!\")\r\nalertcondition(crossunder(MAvg, PMax), title=\"Crossunder Alarm\", message=\"Moving Avg SELL SIGNAL!\")\r\nalertcondition(cross(src, PMax), title=\"Price Cross Alert\", message=\"PMax - Price Crossing!\")\r\nalertcondition(crossover(src, PMax), title=\"Price Crossover Alarm\", message=\"PRICE OVER PMax - BUY SIGNAL!\")\r\nalertcondition(crossunder(src, PMax), title=\"Price Crossunder Alarm\", message=\"PRICE UNDER PMax - SELL SIGNAL!\")\r\nbuySignalk = crossover(MAvg, PMax)\r\nplotshape(buySignalk and showsignalsk ? PMax*0.995 : na, title=\"Buy\", text=\"Buy\", location=location.absolute, style=shape.labelup, size=size.tiny, color=color.green, textcolor=color.white, transp=0)\r\nsellSignallk = crossunder(MAvg, PMax)\r\nplotshape(sellSignallk and showsignalsk ? PMax*1.005 : na, title=\"Sell\", text=\"Sell\", location=location.absolute, style=shape.labeldown, size=size.tiny, color=color.red, textcolor=color.white, transp=0)\r\nbuySignalc = crossover(src, PMax)\r\nplotshape(buySignalc and showsignalsc ? PMax*0.995 : na, title=\"Buy\", text=\"Buy\", location=location.absolute, style=shape.labelup, size=size.tiny, color=#0F18BF, textcolor=color.white, transp=0)\r\nsellSignallc = crossunder(src, PMax)\r\nplotshape(sellSignallc and showsignalsc ? PMax*1.005 : na, title=\"Sell\", text=\"Sell\", location=location.absolute, style=shape.labeldown, size=size.tiny, color=#0F18BF, textcolor=color.white, transp=0)\r\nmPlot = plot(ohlc4, title=\"\", style=plot.style_circles, linewidth=0,display=display.none)\r\nlongFillColor = highlighting ? (MAvg>PMax ? color.green : na) : na\r\nshortFillColor = highlighting ? (MAvg<PMax ? color.red : na) : na\r\nfill(mPlot, pALL, title=\"UpTrend Highligter\", color=longFillColor)\r\nfill(mPlot, pALL, title=\"DownTrend Highligter\", color=shortFillColor)\r\n\r\n  ","updated":"2021-02-16T22:48:24.439866Z","version":"3.0"}