{"created":"2020-12-24T09:37:47.345864Z","extra":{"kind":"study","sourceInputsCount":1},"lastVersionMaj":"3.0","scriptAccess":"open_no_auth","scriptName":"Optimized Trend Tracker","source":"//@version=4\r\n// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/\r\n// © KivancOzbilgic\r\n\r\n//created by: @Anil_Ozeksi\r\n//developer: ANIL ÖZEKŞİ\r\n//author: @kivancozbilgic\r\n\r\nstudy(\"Optimized Trend Tracker\",\"OTT\", overlay=true)\r\nsrc = input(close, title=\"Source\")\r\nlength=input(2, \"OTT Period\", minval=1)\r\npercent=input(1.4, \"OTT Percent\", type=input.float, step=0.1, minval=0)\r\nshowsupport = input(title=\"Show Support Line?\", type=input.bool, defval=true)\r\nshowsignalsk = input(title=\"Show Support Line Crossing Signals?\", type=input.bool, defval=true)\r\nshowsignalsc = input(title=\"Show Price/OTT Crossing Signals?\", type=input.bool, defval=false)\r\nhighlight = input(title=\"Show OTT Color Changes?\", type=input.bool, defval=false)\r\nshowsignalsr = input(title=\"Show OTT Color Change Signals?\", type=input.bool, defval=false)\r\nhighlighting = input(title=\"Highlighter On/Off ?\", type=input.bool, defval=true)\r\nmav = input(title=\"Moving Average Type\", defval=\"VAR\", options=[\"SMA\", \"EMA\", \"WMA\", \"TMA\", \"VAR\", \"WWMA\", \"ZLEMA\", \"TSF\"])\r\nVar_Func(src,length)=>\r\n    valpha=2/(length+1)\r\n    vud1=src>src[1] ? src-src[1] : 0\r\n    vdd1=src<src[1] ? src[1]-src : 0\r\n    vUD=sum(vud1,9)\r\n    vDD=sum(vdd1,9)\r\n    vCMO=nz((vUD-vDD)/(vUD+vDD))\r\n    VAR=0.0\r\n    VAR:=nz(valpha*abs(vCMO)*src)+(1-valpha*abs(vCMO))*nz(VAR[1])\r\nVAR=Var_Func(src,length)\r\nWwma_Func(src,length)=>\r\n    wwalpha = 1/ length\r\n    WWMA = 0.0\r\n    WWMA := wwalpha*src + (1-wwalpha)*nz(WWMA[1])\r\nWWMA=Wwma_Func(src,length)\r\nZlema_Func(src,length)=>\r\n    zxLag = length/2==round(length/2) ? length/2 : (length - 1) / 2\r\n    zxEMAData = (src + (src - src[zxLag]))\r\n    ZLEMA = ema(zxEMAData, length)\r\nZLEMA=Zlema_Func(src,length)\r\nTsf_Func(src,length)=>\r\n    lrc = linreg(src, length, 0)\r\n    lrc1 = linreg(src,length,1)\r\n    lrs = (lrc-lrc1)\r\n    TSF = linreg(src, length, 0)+lrs\r\nTSF=Tsf_Func(src,length)\r\ngetMA(src, length) =>\r\n    ma = 0.0\r\n    if mav == \"SMA\"\r\n        ma := sma(src, length)\r\n        ma\r\n\r\n    if mav == \"EMA\"\r\n        ma := ema(src, length)\r\n        ma\r\n\r\n    if mav == \"WMA\"\r\n        ma := wma(src, length)\r\n        ma\r\n\r\n    if mav == \"TMA\"\r\n        ma := sma(sma(src, ceil(length / 2)), floor(length / 2) + 1)\r\n        ma\r\n\r\n    if mav == \"VAR\"\r\n        ma := VAR\r\n        ma\r\n\r\n    if mav == \"WWMA\"\r\n        ma := WWMA\r\n        ma\r\n\r\n    if mav == \"ZLEMA\"\r\n        ma := ZLEMA\r\n        ma\r\n\r\n    if mav == \"TSF\"\r\n        ma := TSF\r\n        ma\r\n    ma\r\n    \r\nMAvg=getMA(src, length)\r\nfark=MAvg*percent*0.01\r\nlongStop = MAvg - fark\r\nlongStopPrev = nz(longStop[1], longStop)\r\nlongStop := MAvg > longStopPrev ? max(longStop, longStopPrev) : longStop\r\nshortStop =  MAvg + fark\r\nshortStopPrev = nz(shortStop[1], shortStop)\r\nshortStop := MAvg < shortStopPrev ? min(shortStop, shortStopPrev) : shortStop\r\ndir = 1\r\ndir := nz(dir[1], dir)\r\ndir := dir == -1 and MAvg > shortStopPrev ? 1 : dir == 1 and MAvg < longStopPrev ? -1 : dir\r\nMT = dir==1 ? longStop: shortStop\r\nOTT=MAvg>MT ? MT*(200+percent)/200 : MT*(200-percent)/200 \r\nplot(showsupport ? MAvg : na, color=#0585E1, linewidth=2, title=\"Support Line\")\r\nOTTC = highlight ? OTT[2] > OTT[3] ? color.green : color.red : #B800D9 \r\npALL=plot(nz(OTT[2]), color=OTTC, linewidth=2, title=\"OTT\", transp=0)\r\nalertcondition(cross(OTT[2], OTT[3]), title=\"Color ALARM\", message=\"OTT Has Changed Color!\")\r\nalertcondition(crossover(OTT[2], OTT[3]), title=\"GREEN ALERT\", message=\"OTT GREEN BUY SIGNAL!\")\r\nalertcondition(crossunder(OTT[2], OTT[3]), title=\"RED ALERT\", message=\"OTT RED SELL SIGNAL!\")\r\nalertcondition(cross(MAvg, OTT[2]), title=\"Cross Alert\", message=\"OTT - Support Line Crossing!\")\r\nalertcondition(crossover(MAvg, OTT[2]), title=\"Crossover Alarm\", message=\"Support Line BUY SIGNAL!\")\r\nalertcondition(crossunder(MAvg, OTT[2]), title=\"Crossunder Alarm\", message=\"Support Line SELL SIGNAL!\")\r\nalertcondition(cross(src, OTT[2]), title=\"Price Cross Alert\", message=\"OTT - Price Crossing!\")\r\nalertcondition(crossover(src, OTT[2]), title=\"Price Crossover Alarm\", message=\"PRICE OVER OTT - BUY SIGNAL!\")\r\nalertcondition(crossunder(src, OTT[2]), title=\"Price Crossunder Alarm\", message=\"PRICE UNDER OTT - SELL SIGNAL!\")\r\nbuySignalk = crossover(MAvg, OTT[2])\r\nplotshape(buySignalk and showsignalsk ? OTT*0.995 : na, title=\"Buy\", text=\"Buy\", location=location.absolute, style=shape.labelup, size=size.tiny, color=color.green, textcolor=color.white, transp=0)\r\nsellSignallk = crossunder(MAvg, OTT[2])\r\nplotshape(sellSignallk and showsignalsk ? OTT*1.005 : na, title=\"Sell\", text=\"Sell\", location=location.absolute, style=shape.labeldown, size=size.tiny, color=color.red, textcolor=color.white, transp=0)\r\nbuySignalc = crossover(src, OTT[2])\r\nplotshape(buySignalc and showsignalsc ? OTT*0.995 : na, title=\"Buy\", text=\"Buy\", location=location.absolute, style=shape.labelup, size=size.tiny, color=color.green, textcolor=color.white, transp=0)\r\nsellSignallc = crossunder(src, OTT[2])\r\nplotshape(sellSignallc and showsignalsc ? OTT*1.005 : na, title=\"Sell\", text=\"Sell\", location=location.absolute, style=shape.labeldown, size=size.tiny, color=color.red, textcolor=color.white, transp=0)\r\nmPlot = plot(ohlc4, title=\"\", style=plot.style_circles, linewidth=0,display=display.none)\r\nlongFillColor = highlighting ? (MAvg>OTT ? color.green : na) : na\r\nshortFillColor = highlighting ? (MAvg<OTT ? color.red : na) : na\r\nfill(mPlot, pALL, title=\"UpTrend Highligter\", color=longFillColor)\r\nfill(mPlot, pALL, title=\"DownTrend Highligter\", color=shortFillColor)\r\nbuySignalr = crossover(OTT[2], OTT[3])\r\nplotshape(buySignalr and showsignalsr ? OTT*0.995 : na, title=\"Buy\", text=\"Buy\", location=location.absolute, style=shape.labelup, size=size.tiny, color=color.green, textcolor=color.white, transp=0)\r\nsellSignallr = crossunder(OTT[2], OTT[3])\r\nplotshape(sellSignallr and showsignalsr ? OTT*1.005 : na, title=\"Sell\", text=\"Sell\", location=location.absolute, style=shape.labeldown, size=size.tiny, color=color.red, textcolor=color.white, transp=0)\r\n  \r\n  \r\n  \r\n","updated":"2020-12-24T09:37:47.345864Z","version":"3.0"}